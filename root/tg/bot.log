2023-05-11T14:30:47.621920+0300 ERROR 'BodyPartReader' object has no attribute 'close'
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\payment_webhook.py", line 149, in <module>
    web.run_app(app, host='127.0.0.1')
    │   │       └ <Application 0x267703a1f90>
    │   └ <function run_app at 0x0000026772B7B2E0>
    └ <module 'aiohttp.web' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiohttp\\web.py'>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiohttp\web.py", line 516, in run_app
    loop.run_until_complete(main_task)
    │    │                  └ <Task pending name='Task-1' coro=<_run_app() running at C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiohttp\web.p...
    │    └ <function BaseEventLoop.run_until_complete at 0x000002677208A980>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x0000026772552980>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002677208C720>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000026772014F40>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiohttp\web_protocol.py", line 433, in _handle_request
    resp = await request_handler(request)
                 │               └ <Request POST /process_csv_to_send_messages >
                 └ <bound method Application._handle of <Application 0x267703a1f90>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiohttp\web_app.py", line 504, in _handle
    resp = await handler(request)
                 │       └ <Request POST /process_csv_to_send_messages >
                 └ <function process_csv at 0x00000267166989A0>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\payment_webhook.py", line 115, in process_csv
    csv_file.close()
    └ <aiohttp.multipart.BodyPartReader object at 0x000002671534CC10>

AttributeError: 'BodyPartReader' object has no attribute 'close'
2023-05-11T14:36:28.996794+0300 ERROR 'BodyPartReader' object has no attribute 'getvalue'
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\payment_webhook.py", line 149, in <module>
    web.run_app(app, host='127.0.0.1')
    │   │       └ <Application 0x26573a75f10>
    │   └ <function run_app at 0x000002657629B2E0>
    └ <module 'aiohttp.web' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiohttp\\web.py'>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiohttp\web.py", line 516, in run_app
    loop.run_until_complete(main_task)
    │    │                  └ <Task pending name='Task-1' coro=<_run_app() running at C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiohttp\web.p...
    │    └ <function BaseEventLoop.run_until_complete at 0x000002657576A980>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x0000026575C52980>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002657576C720>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000265756E8F40>
    └ <Handle <TaskStepMethWrapper object at 0x0000026519D5FAC0>()>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000026519D5FAC0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000026519D5FAC0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000026519D5FAC0>()>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiohttp\web_protocol.py", line 433, in _handle_request
    resp = await request_handler(request)
                 │               └ <Request POST /process_csv_to_send_messages >
                 └ <bound method Application._handle of <Application 0x26573a75f10>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiohttp\web_app.py", line 504, in _handle
    resp = await handler(request)
                 │       └ <Request POST /process_csv_to_send_messages >
                 └ <function process_csv at 0x0000026519DC8900>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\payment_webhook.py", line 115, in process_csv
    await csv_file.release(initial_value=csv_file.getvalue().decode('utf-8'))
          │        │                     └ <aiohttp.multipart.BodyPartReader object at 0x0000026519DAFCD0>
          │        └ <function BodyPartReader.release at 0x0000026576029A80>
          └ <aiohttp.multipart.BodyPartReader object at 0x0000026519DAFCD0>

AttributeError: 'BodyPartReader' object has no attribute 'getvalue'
2023-05-11T16:17:21.923673+0300 INFO Someone tried to access admin panel without paassword
2023-05-11T17:01:43.529298+0300 INFO inside send pm link
2023-05-11T17:01:43.551051+0300 ERROR An error has been caught in function 'get_ikb_to_send_payment_link', process 'MainProcess' (13320), thread 'MainThread' (14676):
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000248A9970860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000248AB988C90>
    └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA0A850>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id': 459471362, 'order_id': '66118174-54c2-4681-91a2-d276a7685c80', 'have_paid': False}
    │      │       └ 'INSERT INTO users (client_tg_id, order_id, have_paid) VALUES (%(client_tg_id)s, %(order_id)s, %(have_paid)s)'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000248CCA06CE0; closed: -1>

psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "users_pkey"
DETAIL:  Key (client_tg_id)=(459471362) already exists.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\utils.py", line 27, in generate_payment_link
    session.commit()
    │       └ <function Session.commit at 0x00000248AA7F8900>
    └ <sqlalchemy.orm.session.Session object at 0x00000248CC76B910>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1905, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x00000248AA7EFA60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000248CCA03110>
  File "<string>", line 2, in commit
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000248CCA03110>
                └ <function SessionTransaction.commit at 0x00000248AA7EF880>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1220, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x00000248AA7EF740>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000248CCA03110>
  File "<string>", line 2, in _prepare_impl
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000248CCA03110>
                └ <function SessionTransaction._prepare_impl at 0x00000248AA7EF6A0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1195, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x00000248AA7FB600>
    │    └ <sqlalchemy.orm.session.Session object at 0x00000248CC76B910>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000248CCA03110>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4153, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x00000248AA7FB7E0>
    └ <sqlalchemy.orm.session.Session object at 0x00000248CC76B910>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4289, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x00000248CCA2CDC0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "users_pkey"\nDETAIL:  Key (...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4250, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x00000248AA7EC2C0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x00000248CA6F1D90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 467, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x00000248CA6F1D90>
    │   └ <function SaveUpdateAll.execute at 0x00000248AA7ECE00>
    └ SaveUpdateAll(Mapper[User(users)])
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 644, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x00000248AA77AFC0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\pe...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\pr...
    └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x00000248AA7A7060>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1040, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x00000248A98AD440>
             └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA0A850>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x00000248CCA0B250>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x00000248A98AD760>
           └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA0A850>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x00000248A98AD940>
          └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA0A850>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x00000248A98AD9E0>
           └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA0A850>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x00000248A98ADC60>
    └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA0A850>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UniqueViolation('duplicate key value violates unique constraint "users_pkey"\nDETAIL:  Key (client_tg_id)=(459471362) already...
          │                    │              └ (<class 'psycopg2.errors.UniqueViolation'>, UniqueViolation('duplicate key value violates unique constraint "users_pkey"\nDET...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "users_pkey"\nDETAIL:  Key (...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000248A9970860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000248AB988C90>
    └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA0A850>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id': 459471362, 'order_id': '66118174-54c2-4681-91a2-d276a7685c80', 'have_paid': False}
    │      │       └ 'INSERT INTO users (client_tg_id, order_id, have_paid) VALUES (%(client_tg_id)s, %(order_id)s, %(have_paid)s)'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000248CCA06CE0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "users_pkey"
DETAIL:  Key (client_tg_id)=(459471362) already exists.

[SQL: INSERT INTO users (client_tg_id, order_id, have_paid) VALUES (%(client_tg_id)s, %(order_id)s, %(have_paid)s)]
[parameters: {'client_tg_id': 459471362, 'order_id': '66118174-54c2-4681-91a2-d276a7685c80', 'have_paid': False}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000248A9970860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000248AB988C90>
    └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA2D290>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT users.client_tg_id AS users_client_tg_id, users.order_id AS users_order_id, users.have_paid AS users_have_paid \nFROM...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000248CCA07AE0; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE users.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 380, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x00000248CCA4F7E0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000248CA46B890>
    │        └ <function start_polling at 0x00000248AA50D6C0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000248AA50E200>
    └ <aiogram.utils.executor.Executor object at 0x00000248CB710A10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x00000248A8885620>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000248A87BF4C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000248A82ED3A0>
    └ <Handle <TaskStepMethWrapper object at 0x00000248CCA1DB70>()>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x00000248CCA1DB70>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x00000248CCA1DB70>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x00000248CCA1DB70>()>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641863, "message": {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000248CA46B890>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x00000248AA1F6650>
                 │    │                │      └ <Update {"update_id": 56641863, "message": {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x00000248AA429940>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x00000248CC9E39D0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000248CA46B890>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x00000248CAF2D150>}
                     │           │        └ (<Message {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "us...
                     │           └ <function send_payment_link at 0x00000248CCA4C4A0>
                     └ Handler.HandlerObj(handler=<function send_payment_link at 0x00000248CCA4C4A0>, spec=FullArgSpec(args=['message', 'state'], va...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 130, in send_payment_link
    reply_markup=get_ikb_to_send_payment_link(message.text, message.from_user.id))
                 │                            │       │     │       └ <aiogram.types.fields.Field object at 0x00000248AA11CD10>
                 │                            │       │     └ <Message {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...
                 │                            │       └ <aiogram.types.fields.Field object at 0x00000248AA1A2C10>
                 │                            └ <Message {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...
                 └ <function get_ikb_to_send_payment_link at 0x00000248ABB41EE0>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\keyboards.py", line 37, in get_ikb_to_send_payment_link
    link = utils.generate_payment_link(phone_number, user_id)
           │     │                     │             └ 459471362
           │     │                     └ '+375297861654'
           │     └ <function generate_payment_link at 0x00000248ABB40EA0>
           └ <module 'utils' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\tg\\utils.py'>

  File "C:\xStorage\Projects\PrometeyBot\root\tg\utils.py", line 30, in generate_payment_link
    user = session.query(models.User).filter(models.User.client_tg_id == client_tg_id).first()
           │       │     │      │            │      │    │               └ 459471362
           │       │     │      │            │      │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000248AB8A5440>
           │       │     │      │            │      └ <class 'root.db.models.User'>
           │       │     │      │            └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
           │       │     │      └ <class 'root.db.models.User'>
           │       │     └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
           │       └ <function Session.query at 0x00000248AA7FA0C0>
           └ <sqlalchemy.orm.session.Session object at 0x00000248CC76B910>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x00000248AA778A40>
           └ <sqlalchemy.orm.query.Query object at 0x00000248CC79E490>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x00000248AA7F8FE0>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x00000248CC76B910>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x00000248CB2D7E10>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x00000248AA7F8D60>
           └ <sqlalchemy.orm.session.Session object at 0x00000248CC76B910>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x00000248AA696CA0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x00000248A98AD440>
             └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA2D290>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x00000248CCA2D210>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x00000248A98AD760>
           └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA2D290>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x00000248A98AD940>
          └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA2D290>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x00000248A98AD9E0>
           └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA2D290>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x00000248A98ADC60>
    └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA2D290>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE users.client_tg_id = 459471362 \n     ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE use...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000248A9970860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000248AB988C90>
    └ <sqlalchemy.engine.base.Connection object at 0x00000248CCA2D290>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT users.client_tg_id AS users_client_tg_id, users.order_id AS users_order_id, users.have_paid AS users_have_paid \nFROM...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000248CCA07AE0; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE users.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT users.client_tg_id AS users_client_tg_id, users.order_id AS users_order_id, users.have_paid AS users_have_paid 
FROM users 
WHERE users.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-05-11T17:01:43.609915+0300 INFO after creating link
2023-05-11T17:01:43.680931+0300 ERROR Can't parse inline keyboard button: text buttons are unallowed in the inline keyboard
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 380, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x00000248CCA4F7E0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000248CA46B890>
    │        └ <function start_polling at 0x00000248AA50D6C0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000248AA50E200>
    └ <aiogram.utils.executor.Executor object at 0x00000248CB710A10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x00000248A8885620>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000248A87BF4C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000248A82ED3A0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641863, "message": {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000248CA46B890>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x00000248AA1F6650>
                 │    │                │      └ <Update {"update_id": 56641863, "message": {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x00000248AA429940>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x00000248CC9E39D0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000248CA46B890>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x00000248CAF2D150>}
                     │           │        └ (<Message {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "us...
                     │           └ <function send_payment_link at 0x00000248CCA4C4A0>
                     └ Handler.HandlerObj(handler=<function send_payment_link at 0x00000248CCA4C4A0>, spec=FullArgSpec(args=['message', 'state'], va...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 129, in send_payment_link
    await message.answer(PAYMENT_LINK_MESSAGE,
          │       │      └ '\nНажмите на кнопку, чтобы перейти на страницу оплаты.\n\nЕсли у Вас нет кнопки "Оплатить" под этим сообщением, нажмите на /...
          │       └ <function Message.answer at 0x00000248AA18A200>
          └ <Message {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\types\message.py", line 438, in answer
    return await self.bot.send_message(
                 │    └ <property object at 0x00000248AA02DE90>
                 └ <Message {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\bot\bot.py", line 346, in send_message
    result = await self.request(api.Methods.SEND_MESSAGE, payload)
                   │    │       │   │       │             └ {'chat_id': 459471362, 'text': '\nНажмите на кнопку, чтобы перейти на страницу оплаты.\n\nЕсли у Вас нет кнопки "Оплатить" по...
                   │    │       │   │       └ <aiogram.utils.helper.Item object at 0x00000248AA204950>
                   │    │       │   └ <class 'aiogram.bot.api.Methods'>
                   │    │       └ <module 'aiogram.bot.api' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\bot\\api.py'>
                   │    └ <function BaseBot.request at 0x00000248AA20D260>
                   └ <aiogram.bot.bot.Bot object at 0x00000248A87D4E10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\bot\base.py", line 236, in request
    return await api.make_request(await self.get_session(), self.server, self.__token, method, data, files,
                 │   │                  │    │              │    │       │             │       │     └ None
                 │   │                  │    │              │    │       │             │       └ {'chat_id': 459471362, 'text': '\nНажмите на кнопку, чтобы перейти на страницу оплаты.\n\nЕсли у Вас нет кнопки "Оплатить" по...
                 │   │                  │    │              │    │       │             └ 'sendMessage'
                 │   │                  │    │              │    │       └ <aiogram.bot.bot.Bot object at 0x00000248A87D4E10>
                 │   │                  │    │              │    └ TelegramAPIServer(base='https://api.telegram.org/bot{token}/{method}', file='https://api.telegram.org/file/bot{token}/{path}')
                 │   │                  │    │              └ <aiogram.bot.bot.Bot object at 0x00000248A87D4E10>
                 │   │                  │    └ <function BaseBot.get_session at 0x00000248AA20CA40>
                 │   │                  └ <aiogram.bot.bot.Bot object at 0x00000248A87D4E10>
                 │   └ <function make_request at 0x00000248AA1B7920>
                 └ <module 'aiogram.bot.api' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\bot\\api.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\bot\api.py", line 140, in make_request
    return check_result(method, response.content_type, response.status, await response.text())
           │            │       │        │             │        │             │        └ <function ClientResponse.text at 0x00000248A9D0F420>
           │            │       │        │             │        │             └ <ClientResponse(https://api.telegram.org/bot5724555976:AAFxd0Ipy9YSR4ZgYBDa-iypq-m1QK2-vp4/sendMessage) [400 Bad Request]>
           │            │       │        │             │        │               <C...
           │            │       │        │             │        └ 400
           │            │       │        │             └ <ClientResponse(https://api.telegram.org/bot5724555976:AAFxd0Ipy9YSR4ZgYBDa-iypq-m1QK2-vp4/sendMessage) [400 Bad Request]>
           │            │       │        │               <C...
           │            │       │        └ <property object at 0x00000248A9BD1DF0>
           │            │       └ <ClientResponse(https://api.telegram.org/bot5724555976:AAFxd0Ipy9YSR4ZgYBDa-iypq-m1QK2-vp4/sendMessage) [400 Bad Request]>
           │            │         <C...
           │            └ 'sendMessage'
           └ <function check_result at 0x00000248AA1B7A60>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\bot\api.py", line 115, in check_result
    exceptions.BadRequest.detect(description)
    │          │          │      └ "Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard"
    │          │          └ <classmethod(<function _MatchErrorMixin.detect at 0x00000248AA011C60>)>
    │          └ <class 'aiogram.utils.exceptions.BadRequest'>
    └ <module 'aiogram.utils.exceptions' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\excep...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\exceptions.py", line 141, in detect
    raise cls(description)
          │   └ "bad request: can't parse inline keyboard button: text buttons are unallowed in the inline keyboard"
          └ <class 'aiogram.utils.exceptions.BadRequest'>

aiogram.utils.exceptions.BadRequest: Can't parse inline keyboard button: text buttons are unallowed in the inline keyboard
2023-05-11T17:01:43.764386+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000248A9970860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000248AB988C90>
    └ <sqlalchemy.engine.base.Connection object at 0x00000248CEA8B410>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000248CCA04120; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 380, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x00000248CCA4F7E0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000248CA46B890>
    │        └ <function start_polling at 0x00000248AA50D6C0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000248AA50E200>
    └ <aiogram.utils.executor.Executor object at 0x00000248CB710A10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x00000248A8885620>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000248A87BF4C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000248A82ED3A0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641863, "message": {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000248CA46B890>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x00000248AA1F6650>
                 │    │                │      └ <Update {"update_id": 56641863, "message": {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x00000248AA429940>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x00000248CC9E39D0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000248CA46B890>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x00000248CAF2D150>}
                     │           │        └ (<Message {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "us...
                     │           └ <function send_payment_link at 0x00000248CCA4C4A0>
                     └ Handler.HandlerObj(handler=<function send_payment_link at 0x00000248CCA4C4A0>, spec=FullArgSpec(args=['message', 'state'], va...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 134, in send_payment_link
    await delete_state_from_db(message.from_user.id)
          │                    │       └ <aiogram.types.fields.Field object at 0x00000248AA11CD10>
          │                    └ <Message {"message_id": 796, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...
          └ <function delete_state_from_db at 0x00000248CC987420>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 67, in delete_state_from_db
    existing_state = session.query(models.State).filter(models.State.client_tg_id==user_id).first()
                     │       │     │      │             │      │     │             └ 459471362
                     │       │     │      │             │      │     └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000248AB8A7420>
                     │       │     │      │             │      └ <class 'root.db.models.State'>
                     │       │     │      │             └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       │     │      └ <class 'root.db.models.State'>
                     │       │     └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       └ <function Session.query at 0x00000248AA7FA0C0>
                     └ <sqlalchemy.orm.session.Session object at 0x00000248CCA09AD0>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x00000248AA778A40>
           └ <sqlalchemy.orm.query.Query object at 0x00000248CC9E2A50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x00000248AA7F8FE0>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x00000248CCA09AD0>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x00000248CCA2D3D0>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x00000248AA7F8D60>
           └ <sqlalchemy.orm.session.Session object at 0x00000248CCA09AD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x00000248AA696CA0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x00000248A98AD440>
             └ <sqlalchemy.engine.base.Connection object at 0x00000248CEA8B410>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x00000248CEA8AED0>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x00000248A98AD760>
           └ <sqlalchemy.engine.base.Connection object at 0x00000248CEA8B410>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x00000248A98AD940>
          └ <sqlalchemy.engine.base.Connection object at 0x00000248CEA8B410>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x00000248A98AD9E0>
           └ <sqlalchemy.engine.base.Connection object at 0x00000248CEA8B410>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x00000248A98ADC60>
    └ <sqlalchemy.engine.base.Connection object at 0x00000248CEA8B410>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE states.client_tg_id = 459471362 \n    ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE sta...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000248A9970860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000248AB988C90>
    └ <sqlalchemy.engine.base.Connection object at 0x00000248CEA8B410>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000248CCA04120; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-05-11T17:29:32.573334+0300 INFO inside send pm link
2023-05-11T17:29:32.583897+0300 ERROR An error has been caught in function 'get_ikb_to_send_payment_link', process 'MainProcess' (13828), thread 'MainThread' (13884):
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001D30F860860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001D31186BD90>
    └ <sqlalchemy.engine.base.Connection object at 0x000001D33292DED0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id': 459471362, 'order_id': '2df5e0e8-5e47-44cd-a966-97cdb35f5c76', 'have_paid': False}
    │      │       └ 'INSERT INTO users (client_tg_id, order_id, have_paid) VALUES (%(client_tg_id)s, %(order_id)s, %(have_paid)s)'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001D332907CA0; closed: -1>

psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "users_pkey"
DETAIL:  Key (client_tg_id)=(459471362) already exists.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\utils.py", line 27, in generate_payment_link
    session.commit()
    │       └ <function Session.commit at 0x000001D3106E8900>
    └ <sqlalchemy.orm.session.Session object at 0x000001D33035A450>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1905, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x000001D3106DFA60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001D332900BE0>
  File "<string>", line 2, in commit
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001D332900BE0>
                └ <function SessionTransaction.commit at 0x000001D3106DF880>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1220, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x000001D3106DF740>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001D332900BE0>
  File "<string>", line 2, in _prepare_impl
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001D332900BE0>
                └ <function SessionTransaction._prepare_impl at 0x000001D3106DF6A0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1195, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x000001D3106EB600>
    │    └ <sqlalchemy.orm.session.Session object at 0x000001D33035A450>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001D332900BE0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4153, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x000001D3106EB7E0>
    └ <sqlalchemy.orm.session.Session object at 0x000001D33035A450>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4289, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001D332CD8240>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "users_pkey"\nDETAIL:  Key (...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4250, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x000001D3106DC2C0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001D33292E710>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 467, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001D33292E710>
    │   └ <function SaveUpdateAll.execute at 0x000001D3106DCE00>
    └ SaveUpdateAll(Mapper[User(users)])
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 644, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x000001D31066AFC0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\pe...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\pr...
    └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x000001D310697060>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1040, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x000001D30F79D440>
             └ <sqlalchemy.engine.base.Connection object at 0x000001D33292DED0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x000001D33292E850>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001D30F79D760>
           └ <sqlalchemy.engine.base.Connection object at 0x000001D33292DED0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001D30F79D940>
          └ <sqlalchemy.engine.base.Connection object at 0x000001D33292DED0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001D30F79D9E0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001D33292DED0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001D30F79DC60>
    └ <sqlalchemy.engine.base.Connection object at 0x000001D33292DED0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UniqueViolation('duplicate key value violates unique constraint "users_pkey"\nDETAIL:  Key (client_tg_id)=(459471362) already...
          │                    │              └ (<class 'psycopg2.errors.UniqueViolation'>, UniqueViolation('duplicate key value violates unique constraint "users_pkey"\nDET...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "users_pkey"\nDETAIL:  Key (...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001D30F860860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001D31186BD90>
    └ <sqlalchemy.engine.base.Connection object at 0x000001D33292DED0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id': 459471362, 'order_id': '2df5e0e8-5e47-44cd-a966-97cdb35f5c76', 'have_paid': False}
    │      │       └ 'INSERT INTO users (client_tg_id, order_id, have_paid) VALUES (%(client_tg_id)s, %(order_id)s, %(have_paid)s)'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001D332907CA0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "users_pkey"
DETAIL:  Key (client_tg_id)=(459471362) already exists.

[SQL: INSERT INTO users (client_tg_id, order_id, have_paid) VALUES (%(client_tg_id)s, %(order_id)s, %(have_paid)s)]
[parameters: {'client_tg_id': 459471362, 'order_id': '2df5e0e8-5e47-44cd-a966-97cdb35f5c76', 'have_paid': False}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001D30F860860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001D31186BD90>
    └ <sqlalchemy.engine.base.Connection object at 0x000001D332CD89D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT users.client_tg_id AS users_client_tg_id, users.order_id AS users_order_id, users.have_paid AS users_have_paid \nFROM...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001D3329042E0; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE users.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 380, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001D33294F7E0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001D33043F7D0>
    │        └ <function start_polling at 0x000001D3103FD6C0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000001D3103FE200>
    └ <aiogram.utils.executor.Executor object at 0x000001D33269E010>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000001D30E795620>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001D30E6CF4C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001D30E20D3A0>
    └ <Handle <TaskStepMethWrapper object at 0x000001D33291F790>()>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000001D33291F790>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000001D33291F790>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000001D33291F790>()>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641866, "message": {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001D33043F7D0>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001D3100E6690>
                 │    │                │      └ <Update {"update_id": 56641866, "message": {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000001D310319940>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001D33272D490>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001D33043F7D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001D33266AED0>}
                     │           │        └ (<Message {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "us...
                     │           └ <function send_payment_link at 0x000001D33294C4A0>
                     └ Handler.HandlerObj(handler=<function send_payment_link at 0x000001D33294C4A0>, spec=FullArgSpec(args=['message', 'state'], va...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 130, in send_payment_link
    reply_markup=get_ikb_to_send_payment_link(message.text, message.from_user.id))
                 │                            │       │     │       └ <aiogram.types.fields.Field object at 0x000001D31000CCD0>
                 │                            │       │     └ <Message {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...
                 │                            │       └ <aiogram.types.fields.Field object at 0x000001D310092C10>
                 │                            └ <Message {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...
                 └ <function get_ikb_to_send_payment_link at 0x000001D311A31EE0>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\keyboards.py", line 37, in get_ikb_to_send_payment_link
    link = utils.generate_payment_link(phone_number, user_id)
           │     │                     │             └ 459471362
           │     │                     └ '+375297861654'
           │     └ <function generate_payment_link at 0x000001D311A30EA0>
           └ <module 'utils' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\tg\\utils.py'>

  File "C:\xStorage\Projects\PrometeyBot\root\tg\utils.py", line 30, in generate_payment_link
    user = session.query(models.User).filter(models.User.client_tg_id == client_tg_id).first()
           │       │     │      │            │      │    │               └ 459471362
           │       │     │      │            │      │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001D311795440>
           │       │     │      │            │      └ <class 'root.db.models.User'>
           │       │     │      │            └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
           │       │     │      └ <class 'root.db.models.User'>
           │       │     └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
           │       └ <function Session.query at 0x000001D3106EA0C0>
           └ <sqlalchemy.orm.session.Session object at 0x000001D33035A450>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x000001D310668A40>
           └ <sqlalchemy.orm.query.Query object at 0x000001D33292E990>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x000001D3106E8FE0>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x000001D33035A450>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x000001D332CD8510>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000001D3106E8D60>
           └ <sqlalchemy.orm.session.Session object at 0x000001D33035A450>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000001D310586CA0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000001D30F79D440>
             └ <sqlalchemy.engine.base.Connection object at 0x000001D332CD89D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000001D332CD8550>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001D30F79D760>
           └ <sqlalchemy.engine.base.Connection object at 0x000001D332CD89D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001D30F79D940>
          └ <sqlalchemy.engine.base.Connection object at 0x000001D332CD89D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001D30F79D9E0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001D332CD89D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001D30F79DC60>
    └ <sqlalchemy.engine.base.Connection object at 0x000001D332CD89D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE users.client_tg_id = 459471362 \n     ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE use...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001D30F860860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001D31186BD90>
    └ <sqlalchemy.engine.base.Connection object at 0x000001D332CD89D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT users.client_tg_id AS users_client_tg_id, users.order_id AS users_order_id, users.have_paid AS users_have_paid \nFROM...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001D3329042E0; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE users.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT users.client_tg_id AS users_client_tg_id, users.order_id AS users_order_id, users.have_paid AS users_have_paid 
FROM users 
WHERE users.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-05-11T17:29:32.633026+0300 INFO after creating link
2023-05-11T17:29:32.709873+0300 ERROR Can't parse inline keyboard button: text buttons are unallowed in the inline keyboard
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 380, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001D33294F7E0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001D33043F7D0>
    │        └ <function start_polling at 0x000001D3103FD6C0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000001D3103FE200>
    └ <aiogram.utils.executor.Executor object at 0x000001D33269E010>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000001D30E795620>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001D30E6CF4C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001D30E20D3A0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641866, "message": {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001D33043F7D0>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001D3100E6690>
                 │    │                │      └ <Update {"update_id": 56641866, "message": {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000001D310319940>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001D33272D490>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001D33043F7D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001D33266AED0>}
                     │           │        └ (<Message {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "us...
                     │           └ <function send_payment_link at 0x000001D33294C4A0>
                     └ Handler.HandlerObj(handler=<function send_payment_link at 0x000001D33294C4A0>, spec=FullArgSpec(args=['message', 'state'], va...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 129, in send_payment_link
    await message.answer(PAYMENT_LINK_MESSAGE,
          │       │      └ '\nНажмите на кнопку, чтобы перейти на страницу оплаты.\n\nЕсли у Вас нет кнопки "Оплатить" под этим сообщением, нажмите на /...
          │       └ <function Message.answer at 0x000001D31007A200>
          └ <Message {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\types\message.py", line 438, in answer
    return await self.bot.send_message(
                 │    └ <property object at 0x000001D30FF1E070>
                 └ <Message {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\bot\bot.py", line 346, in send_message
    result = await self.request(api.Methods.SEND_MESSAGE, payload)
                   │    │       │   │       │             └ {'chat_id': 459471362, 'text': '\nНажмите на кнопку, чтобы перейти на страницу оплаты.\n\nЕсли у Вас нет кнопки "Оплатить" по...
                   │    │       │   │       └ <aiogram.utils.helper.Item object at 0x000001D3100F4A10>
                   │    │       │   └ <class 'aiogram.bot.api.Methods'>
                   │    │       └ <module 'aiogram.bot.api' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\bot\\api.py'>
                   │    └ <function BaseBot.request at 0x000001D3100FD260>
                   └ <aiogram.bot.bot.Bot object at 0x000001D30E6E4E10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\bot\base.py", line 236, in request
    return await api.make_request(await self.get_session(), self.server, self.__token, method, data, files,
                 │   │                  │    │              │    │       │             │       │     └ None
                 │   │                  │    │              │    │       │             │       └ {'chat_id': 459471362, 'text': '\nНажмите на кнопку, чтобы перейти на страницу оплаты.\n\nЕсли у Вас нет кнопки "Оплатить" по...
                 │   │                  │    │              │    │       │             └ 'sendMessage'
                 │   │                  │    │              │    │       └ <aiogram.bot.bot.Bot object at 0x000001D30E6E4E10>
                 │   │                  │    │              │    └ TelegramAPIServer(base='https://api.telegram.org/bot{token}/{method}', file='https://api.telegram.org/file/bot{token}/{path}')
                 │   │                  │    │              └ <aiogram.bot.bot.Bot object at 0x000001D30E6E4E10>
                 │   │                  │    └ <function BaseBot.get_session at 0x000001D3100FCA40>
                 │   │                  └ <aiogram.bot.bot.Bot object at 0x000001D30E6E4E10>
                 │   └ <function make_request at 0x000001D3100A7920>
                 └ <module 'aiogram.bot.api' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\bot\\api.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\bot\api.py", line 140, in make_request
    return check_result(method, response.content_type, response.status, await response.text())
           │            │       │        │             │        │             │        └ <function ClientResponse.text at 0x000001D30FBFF420>
           │            │       │        │             │        │             └ <ClientResponse(https://api.telegram.org/bot5724555976:AAFxd0Ipy9YSR4ZgYBDa-iypq-m1QK2-vp4/sendMessage) [400 Bad Request]>
           │            │       │        │             │        │               <C...
           │            │       │        │             │        └ 400
           │            │       │        │             └ <ClientResponse(https://api.telegram.org/bot5724555976:AAFxd0Ipy9YSR4ZgYBDa-iypq-m1QK2-vp4/sendMessage) [400 Bad Request]>
           │            │       │        │               <C...
           │            │       │        └ <property object at 0x000001D30FAC1DF0>
           │            │       └ <ClientResponse(https://api.telegram.org/bot5724555976:AAFxd0Ipy9YSR4ZgYBDa-iypq-m1QK2-vp4/sendMessage) [400 Bad Request]>
           │            │         <C...
           │            └ 'sendMessage'
           └ <function check_result at 0x000001D3100A7A60>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\bot\api.py", line 115, in check_result
    exceptions.BadRequest.detect(description)
    │          │          │      └ "Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard"
    │          │          └ <classmethod(<function _MatchErrorMixin.detect at 0x000001D30FF01C60>)>
    │          └ <class 'aiogram.utils.exceptions.BadRequest'>
    └ <module 'aiogram.utils.exceptions' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\excep...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\exceptions.py", line 141, in detect
    raise cls(description)
          │   └ "bad request: can't parse inline keyboard button: text buttons are unallowed in the inline keyboard"
          └ <class 'aiogram.utils.exceptions.BadRequest'>

aiogram.utils.exceptions.BadRequest: Can't parse inline keyboard button: text buttons are unallowed in the inline keyboard
2023-05-11T17:29:32.773269+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001D30F860860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001D31186BD90>
    └ <sqlalchemy.engine.base.Connection object at 0x000001D3326A3390>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001D332904120; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 380, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001D33294F7E0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001D33043F7D0>
    │        └ <function start_polling at 0x000001D3103FD6C0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000001D3103FE200>
    └ <aiogram.utils.executor.Executor object at 0x000001D33269E010>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000001D30E795620>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001D30E6CF4C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001D30E20D3A0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641866, "message": {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001D33043F7D0>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001D3100E6690>
                 │    │                │      └ <Update {"update_id": 56641866, "message": {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000001D310319940>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001D33272D490>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001D33043F7D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001D33266AED0>}
                     │           │        └ (<Message {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "us...
                     │           └ <function send_payment_link at 0x000001D33294C4A0>
                     └ Handler.HandlerObj(handler=<function send_payment_link at 0x000001D33294C4A0>, spec=FullArgSpec(args=['message', 'state'], va...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 134, in send_payment_link
    await delete_state_from_db(message.from_user.id)
          │                    │       └ <aiogram.types.fields.Field object at 0x000001D31000CCD0>
          │                    └ <Message {"message_id": 800, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...
          └ <function delete_state_from_db at 0x000001D332883420>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 67, in delete_state_from_db
    existing_state = session.query(models.State).filter(models.State.client_tg_id==user_id).first()
                     │       │     │      │             │      │     │             └ 459471362
                     │       │     │      │             │      │     └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001D311797420>
                     │       │     │      │             │      └ <class 'root.db.models.State'>
                     │       │     │      │             └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       │     │      └ <class 'root.db.models.State'>
                     │       │     └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       └ <function Session.query at 0x000001D3106EA0C0>
                     └ <sqlalchemy.orm.session.Session object at 0x000001D33268FA10>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x000001D310668A40>
           └ <sqlalchemy.orm.query.Query object at 0x000001D332DC15D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x000001D3106E8FE0>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x000001D33268FA10>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x000001D33266AD90>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000001D3106E8D60>
           └ <sqlalchemy.orm.session.Session object at 0x000001D33268FA10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000001D310586CA0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000001D30F79D440>
             └ <sqlalchemy.engine.base.Connection object at 0x000001D3326A3390>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000001D334995E10>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001D30F79D760>
           └ <sqlalchemy.engine.base.Connection object at 0x000001D3326A3390>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001D30F79D940>
          └ <sqlalchemy.engine.base.Connection object at 0x000001D3326A3390>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001D30F79D9E0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001D3326A3390>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001D30F79DC60>
    └ <sqlalchemy.engine.base.Connection object at 0x000001D3326A3390>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE states.client_tg_id = 459471362 \n    ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE sta...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001D30F860860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001D31186BD90>
    └ <sqlalchemy.engine.base.Connection object at 0x000001D3326A3390>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001D332904120; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-05-11T17:30:34.704677+0300 INFO Someone tried to access admin panel without paassword
2023-05-11T17:31:00.552715+0300 INFO inside send pm link
2023-05-11T17:31:00.563717+0300 ERROR An error has been caught in function 'get_ikb_to_send_payment_link', process 'MainProcess' (13352), thread 'MainThread' (8020):
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001E1D52C0860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001E1D72C9790>
    └ <sqlalchemy.engine.base.Connection object at 0x000001E1F83AAC90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id': 459471362, 'order_id': 'b82a6126-21c6-451e-b890-2ac41facafd0', 'have_paid': False}
    │      │       └ 'INSERT INTO users (client_tg_id, order_id, have_paid) VALUES (%(client_tg_id)s, %(order_id)s, %(have_paid)s)'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001E1F8356CE0; closed: -1>

psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "users_pkey"
DETAIL:  Key (client_tg_id)=(459471362) already exists.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\utils.py", line 27, in generate_payment_link
    session.commit()
    │       └ <function Session.commit at 0x000001E1D6148900>
    └ <sqlalchemy.orm.session.Session object at 0x000001E1F810B710>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1905, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x000001E1D613FA60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001E1F8352B20>
  File "<string>", line 2, in commit
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001E1F8352B20>
                └ <function SessionTransaction.commit at 0x000001E1D613F880>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1220, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x000001E1D613F740>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001E1F8352B20>
  File "<string>", line 2, in _prepare_impl
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001E1F8352B20>
                └ <function SessionTransaction._prepare_impl at 0x000001E1D613F6A0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1195, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x000001E1D614B600>
    │    └ <sqlalchemy.orm.session.Session object at 0x000001E1F810B710>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001E1F8352B20>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4153, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x000001E1D614B7E0>
    └ <sqlalchemy.orm.session.Session object at 0x000001E1F810B710>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4289, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001E1F837D040>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "users_pkey"\nDETAIL:  Key (...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4250, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x000001E1D613C2C0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001E1F83A9D90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 467, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001E1F83A9D90>
    │   └ <function SaveUpdateAll.execute at 0x000001E1D613CE00>
    └ SaveUpdateAll(Mapper[User(users)])
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 644, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x000001E1D60CAFC0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\pe...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\pr...
    └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x000001E1D60F7060>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1040, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x000001E1D51FD440>
             └ <sqlalchemy.engine.base.Connection object at 0x000001E1F83AAC90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x000001E1F80F7390>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001E1D51FD760>
           └ <sqlalchemy.engine.base.Connection object at 0x000001E1F83AAC90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001E1D51FD940>
          └ <sqlalchemy.engine.base.Connection object at 0x000001E1F83AAC90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001E1D51FD9E0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001E1F83AAC90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001E1D51FDC60>
    └ <sqlalchemy.engine.base.Connection object at 0x000001E1F83AAC90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UniqueViolation('duplicate key value violates unique constraint "users_pkey"\nDETAIL:  Key (client_tg_id)=(459471362) already...
          │                    │              └ (<class 'psycopg2.errors.UniqueViolation'>, UniqueViolation('duplicate key value violates unique constraint "users_pkey"\nDET...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "users_pkey"\nDETAIL:  Key (...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001E1D52C0860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001E1D72C9790>
    └ <sqlalchemy.engine.base.Connection object at 0x000001E1F83AAC90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id': 459471362, 'order_id': 'b82a6126-21c6-451e-b890-2ac41facafd0', 'have_paid': False}
    │      │       └ 'INSERT INTO users (client_tg_id, order_id, have_paid) VALUES (%(client_tg_id)s, %(order_id)s, %(have_paid)s)'
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001E1F8356CE0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "users_pkey"
DETAIL:  Key (client_tg_id)=(459471362) already exists.

[SQL: INSERT INTO users (client_tg_id, order_id, have_paid) VALUES (%(client_tg_id)s, %(order_id)s, %(have_paid)s)]
[parameters: {'client_tg_id': 459471362, 'order_id': 'b82a6126-21c6-451e-b890-2ac41facafd0', 'have_paid': False}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001E1D52C0860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001E1D72C9790>
    └ <sqlalchemy.engine.base.Connection object at 0x000001E1F837D4D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT users.client_tg_id AS users_client_tg_id, users.order_id AS users_order_id, users.have_paid AS users_have_paid \nFROM...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001E1F8357AE0; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE users.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 380, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001E1F839F7E0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001E1F7060BD0>
    │        └ <function start_polling at 0x000001E1D5E5D6C0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000001E1D5E5E200>
    └ <aiogram.utils.executor.Executor object at 0x000001E1F83A9890>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000001E1D4225620>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001E1D415F4C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001E1D3C9D3A0>
    └ <Handle <TaskStepMethWrapper object at 0x000001E1F836D480>()>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000001E1F836D480>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000001E1F836D480>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000001E1F836D480>()>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641867, "message": {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001E1F7060BD0>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001E1D5B46210>
                 │    │                │      └ <Update {"update_id": 56641867, "message": {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000001E1D5D79940>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001E1F811DE10>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001E1F7060BD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001E1F80F7310>}
                     │           │        └ (<Message {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "us...
                     │           └ <function send_payment_link at 0x000001E1F839C4A0>
                     └ Handler.HandlerObj(handler=<function send_payment_link at 0x000001E1F839C4A0>, spec=FullArgSpec(args=['message', 'state'], va...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 130, in send_payment_link
    reply_markup=get_ikb_to_send_payment_link(message.text, message.from_user.id))
                 │                            │       │     │       └ <aiogram.types.fields.Field object at 0x000001E1D5A6C810>
                 │                            │       │     └ <Message {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...
                 │                            │       └ <aiogram.types.fields.Field object at 0x000001E1D5AF27D0>
                 │                            └ <Message {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...
                 └ <function get_ikb_to_send_payment_link at 0x000001E1D7491EE0>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\keyboards.py", line 37, in get_ikb_to_send_payment_link
    link = utils.generate_payment_link(phone_number, user_id)
           │     │                     │             └ 459471362
           │     │                     └ 'Otvet'
           │     └ <function generate_payment_link at 0x000001E1D7490EA0>
           └ <module 'utils' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\tg\\utils.py'>

  File "C:\xStorage\Projects\PrometeyBot\root\tg\utils.py", line 30, in generate_payment_link
    user = session.query(models.User).filter(models.User.client_tg_id == client_tg_id).first()
           │       │     │      │            │      │    │               └ 459471362
           │       │     │      │            │      │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001E1D71F5440>
           │       │     │      │            │      └ <class 'root.db.models.User'>
           │       │     │      │            └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
           │       │     │      └ <class 'root.db.models.User'>
           │       │     └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
           │       └ <function Session.query at 0x000001E1D614A0C0>
           └ <sqlalchemy.orm.session.Session object at 0x000001E1F810B710>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x000001E1D60C8A40>
           └ <sqlalchemy.orm.query.Query object at 0x000001E1F80F6810>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x000001E1D6148FE0>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x000001E1F810B710>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x000001E1F80E2E90>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000001E1D6148D60>
           └ <sqlalchemy.orm.session.Session object at 0x000001E1F810B710>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000001E1D5FE6CA0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000001E1D51FD440>
             └ <sqlalchemy.engine.base.Connection object at 0x000001E1F837D4D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000001E1F837D610>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001E1D51FD760>
           └ <sqlalchemy.engine.base.Connection object at 0x000001E1F837D4D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001E1D51FD940>
          └ <sqlalchemy.engine.base.Connection object at 0x000001E1F837D4D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001E1D51FD9E0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001E1F837D4D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001E1D51FDC60>
    └ <sqlalchemy.engine.base.Connection object at 0x000001E1F837D4D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE users.client_tg_id = 459471362 \n     ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE use...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001E1D52C0860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001E1D72C9790>
    └ <sqlalchemy.engine.base.Connection object at 0x000001E1F837D4D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT users.client_tg_id AS users_client_tg_id, users.order_id AS users_order_id, users.have_paid AS users_have_paid \nFROM...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001E1F8357AE0; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE users.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT users.client_tg_id AS users_client_tg_id, users.order_id AS users_order_id, users.have_paid AS users_have_paid 
FROM users 
WHERE users.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-05-11T17:31:00.615747+0300 INFO after creating link
2023-05-11T17:31:00.683088+0300 ERROR Can't parse inline keyboard button: text buttons are unallowed in the inline keyboard
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 380, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001E1F839F7E0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001E1F7060BD0>
    │        └ <function start_polling at 0x000001E1D5E5D6C0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000001E1D5E5E200>
    └ <aiogram.utils.executor.Executor object at 0x000001E1F83A9890>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000001E1D4225620>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001E1D415F4C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001E1D3C9D3A0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641867, "message": {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001E1F7060BD0>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001E1D5B46210>
                 │    │                │      └ <Update {"update_id": 56641867, "message": {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000001E1D5D79940>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001E1F811DE10>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001E1F7060BD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001E1F80F7310>}
                     │           │        └ (<Message {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "us...
                     │           └ <function send_payment_link at 0x000001E1F839C4A0>
                     └ Handler.HandlerObj(handler=<function send_payment_link at 0x000001E1F839C4A0>, spec=FullArgSpec(args=['message', 'state'], va...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 129, in send_payment_link
    await message.answer(PAYMENT_LINK_MESSAGE,
          │       │      └ '\nНажмите на кнопку, чтобы перейти на страницу оплаты.\n\nЕсли у Вас нет кнопки "Оплатить" под этим сообщением, нажмите на /...
          │       └ <function Message.answer at 0x000001E1D5ADA200>
          └ <Message {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\types\message.py", line 438, in answer
    return await self.bot.send_message(
                 │    └ <property object at 0x000001E1D597E020>
                 └ <Message {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\bot\bot.py", line 346, in send_message
    result = await self.request(api.Methods.SEND_MESSAGE, payload)
                   │    │       │   │       │             └ {'chat_id': 459471362, 'text': '\nНажмите на кнопку, чтобы перейти на страницу оплаты.\n\nЕсли у Вас нет кнопки "Оплатить" по...
                   │    │       │   │       └ <aiogram.utils.helper.Item object at 0x000001E1D5B54510>
                   │    │       │   └ <class 'aiogram.bot.api.Methods'>
                   │    │       └ <module 'aiogram.bot.api' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\bot\\api.py'>
                   │    └ <function BaseBot.request at 0x000001E1D5B5D260>
                   └ <aiogram.bot.bot.Bot object at 0x000001E1D4174E10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\bot\base.py", line 236, in request
    return await api.make_request(await self.get_session(), self.server, self.__token, method, data, files,
                 │   │                  │    │              │    │       │             │       │     └ None
                 │   │                  │    │              │    │       │             │       └ {'chat_id': 459471362, 'text': '\nНажмите на кнопку, чтобы перейти на страницу оплаты.\n\nЕсли у Вас нет кнопки "Оплатить" по...
                 │   │                  │    │              │    │       │             └ 'sendMessage'
                 │   │                  │    │              │    │       └ <aiogram.bot.bot.Bot object at 0x000001E1D4174E10>
                 │   │                  │    │              │    └ TelegramAPIServer(base='https://api.telegram.org/bot{token}/{method}', file='https://api.telegram.org/file/bot{token}/{path}')
                 │   │                  │    │              └ <aiogram.bot.bot.Bot object at 0x000001E1D4174E10>
                 │   │                  │    └ <function BaseBot.get_session at 0x000001E1D5B5CA40>
                 │   │                  └ <aiogram.bot.bot.Bot object at 0x000001E1D4174E10>
                 │   └ <function make_request at 0x000001E1D5B07920>
                 └ <module 'aiogram.bot.api' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\bot\\api.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\bot\api.py", line 140, in make_request
    return check_result(method, response.content_type, response.status, await response.text())
           │            │       │        │             │        │             │        └ <function ClientResponse.text at 0x000001E1D565F420>
           │            │       │        │             │        │             └ <ClientResponse(https://api.telegram.org/bot5724555976:AAFxd0Ipy9YSR4ZgYBDa-iypq-m1QK2-vp4/sendMessage) [400 Bad Request]>
           │            │       │        │             │        │               <C...
           │            │       │        │             │        └ 400
           │            │       │        │             └ <ClientResponse(https://api.telegram.org/bot5724555976:AAFxd0Ipy9YSR4ZgYBDa-iypq-m1QK2-vp4/sendMessage) [400 Bad Request]>
           │            │       │        │               <C...
           │            │       │        └ <property object at 0x000001E1D5521EE0>
           │            │       └ <ClientResponse(https://api.telegram.org/bot5724555976:AAFxd0Ipy9YSR4ZgYBDa-iypq-m1QK2-vp4/sendMessage) [400 Bad Request]>
           │            │         <C...
           │            └ 'sendMessage'
           └ <function check_result at 0x000001E1D5B07A60>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\bot\api.py", line 115, in check_result
    exceptions.BadRequest.detect(description)
    │          │          │      └ "Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard"
    │          │          └ <classmethod(<function _MatchErrorMixin.detect at 0x000001E1D5961C60>)>
    │          └ <class 'aiogram.utils.exceptions.BadRequest'>
    └ <module 'aiogram.utils.exceptions' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\excep...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\exceptions.py", line 141, in detect
    raise cls(description)
          │   └ "bad request: can't parse inline keyboard button: text buttons are unallowed in the inline keyboard"
          └ <class 'aiogram.utils.exceptions.BadRequest'>

aiogram.utils.exceptions.BadRequest: Can't parse inline keyboard button: text buttons are unallowed in the inline keyboard
2023-05-11T17:31:00.751116+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001E1D52C0860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001E1D72C9790>
    └ <sqlalchemy.engine.base.Connection object at 0x000001E1FA2AB890>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001E1F8354120; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 380, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001E1F839F7E0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001E1F7060BD0>
    │        └ <function start_polling at 0x000001E1D5E5D6C0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000001E1D5E5E200>
    └ <aiogram.utils.executor.Executor object at 0x000001E1F83A9890>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000001E1D4225620>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001E1D415F4C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001E1D3C9D3A0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641867, "message": {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001E1F7060BD0>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001E1D5B46210>
                 │    │                │      └ <Update {"update_id": 56641867, "message": {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000001E1D5D79940>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001E1F811DE10>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001E1F7060BD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001E1F80F7310>}
                     │           │        └ (<Message {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "us...
                     │           └ <function send_payment_link at 0x000001E1F839C4A0>
                     └ Handler.HandlerObj(handler=<function send_payment_link at 0x000001E1F839C4A0>, spec=FullArgSpec(args=['message', 'state'], va...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 134, in send_payment_link
    await delete_state_from_db(message.from_user.id)
          │                    │       └ <aiogram.types.fields.Field object at 0x000001E1D5A6C810>
          │                    └ <Message {"message_id": 802, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "RF", "use...
          └ <function delete_state_from_db at 0x000001E1F82DB420>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 67, in delete_state_from_db
    existing_state = session.query(models.State).filter(models.State.client_tg_id==user_id).first()
                     │       │     │      │             │      │     │             └ 459471362
                     │       │     │      │             │      │     └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001E1D71F7420>
                     │       │     │      │             │      └ <class 'root.db.models.State'>
                     │       │     │      │             └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       │     │      └ <class 'root.db.models.State'>
                     │       │     └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       └ <function Session.query at 0x000001E1D614A0C0>
                     └ <sqlalchemy.orm.session.Session object at 0x000001E1F811D3D0>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x000001E1D60C8A40>
           └ <sqlalchemy.orm.query.Query object at 0x000001E1FA206010>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x000001E1D6148FE0>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x000001E1F811D3D0>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x000001E1F80F6A10>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000001E1D6148D60>
           └ <sqlalchemy.orm.session.Session object at 0x000001E1F811D3D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000001E1D5FE6CA0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000001E1D51FD440>
             └ <sqlalchemy.engine.base.Connection object at 0x000001E1FA2AB890>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000001E1FA2AB950>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001E1D51FD760>
           └ <sqlalchemy.engine.base.Connection object at 0x000001E1FA2AB890>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001E1D51FD940>
          └ <sqlalchemy.engine.base.Connection object at 0x000001E1FA2AB890>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001E1D51FD9E0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001E1FA2AB890>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001E1D51FDC60>
    └ <sqlalchemy.engine.base.Connection object at 0x000001E1FA2AB890>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE states.client_tg_id = 459471362 \n    ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE sta...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001E1D52C0860>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001E1D72C9790>
    └ <sqlalchemy.engine.base.Connection object at 0x000001E1FA2AB890>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001E1F8354120; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-06-23T10:33:16.051521+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000243F8028D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000243FA01BE90>
    └ <sqlalchemy.engine.base.Connection object at 0x000002439B487350>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002439B589EE0; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000002439B033F60>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000243FA210ED0>
    │        └ <function start_polling at 0x00000243F8BC9C60>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000243F8BCA7A0>
    └ <aiogram.utils.executor.Executor object at 0x000002439B03EC50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x00000243F6F29B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000243F6E7B9C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000243F6DA18A0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641875, "message": {"message_id": 818, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000243FA210ED0>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x00000243F889F490>
                 │    │                │      └ <Update {"update_id": 56641875, "message": {"message_id": 818, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x00000243F8ACDEE0>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x00000243FA211E10>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000243FA210ED0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000002439B4873D0>}
                     │           │        └ (<Message {"message_id": 818, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000002439B030A40>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000002439B030A40>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 225, in check_task
    await delete_state_from_db(message.from_user.id)
          │                    │       └ <aiogram.types.fields.Field object at 0x00000243F87D1C10>
          │                    └ <Message {"message_id": 818, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ⁽...
          └ <function delete_state_from_db at 0x000002439B016FC0>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 69, in delete_state_from_db
    existing_state = session.query(models.State).filter(models.State.client_tg_id == user_id).first()
                     │       │     │      │             │      │     │               └ 459471362
                     │       │     │      │             │      │     └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000243F9F679C0>
                     │       │     │      │             │      └ <class 'root.db.models.State'>
                     │       │     │      │             └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       │     │      └ <class 'root.db.models.State'>
                     │       │     └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       └ <function Session.query at 0x00000243F8EB2660>
                     └ <sqlalchemy.orm.session.Session object at 0x000002439B5132D0>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x00000243F8E2CFE0>
           └ <sqlalchemy.orm.query.Query object at 0x00000243FFEA0110>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x00000243F8EB1580>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x000002439B5132D0>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x000002439B518FD0>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x00000243F8EB1300>
           └ <sqlalchemy.orm.session.Session object at 0x000002439B5132D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x00000243F8D4F240>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x00000243F7F5D940>
             └ <sqlalchemy.engine.base.Connection object at 0x000002439B487350>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002439B661510>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x00000243F7F5DC60>
           └ <sqlalchemy.engine.base.Connection object at 0x000002439B487350>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x00000243F7F5DE40>
          └ <sqlalchemy.engine.base.Connection object at 0x000002439B487350>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x00000243F7F5DEE0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002439B487350>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x00000243F7F5E160>
    └ <sqlalchemy.engine.base.Connection object at 0x000002439B487350>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE states.client_tg_id = 459471362 \n    ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE sta...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000243F8028D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000243FA01BE90>
    └ <sqlalchemy.engine.base.Connection object at 0x000002439B487350>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002439B589EE0; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-06-23T10:36:44.065172+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A846988D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A8489A50D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A869D50050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A86D503220; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000002A8698E3F60>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>
    │        └ <function start_polling at 0x000002A847525C60>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000002A8475267A0>
    └ <aiogram.utils.executor.Executor object at 0x000002A8698EE250>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000002A845889B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002A8457DB9C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002A8457018A0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641879, "message": {"message_id": 832, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000002A8471FF3D0>
                 │    │                │      └ <Update {"update_id": 56641879, "message": {"message_id": 832, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000002A84742DEE0>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000002A848B71ED0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000002A8697E4850>}
                     │           │        └ (<Message {"message_id": 832, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000002A8698E0A40>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000002A8698E0A40>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 225, in check_task
    await delete_state_from_db(message.from_user.id)
          │                    │       └ <aiogram.types.fields.Field object at 0x000002A847131B50>
          │                    └ <Message {"message_id": 832, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ⁽...
          └ <function delete_state_from_db at 0x000002A8698C6FC0>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 69, in delete_state_from_db
    existing_state = session.query(models.State).filter(models.State.client_tg_id == user_id).first()
                     │       │     │      │             │      │     │               └ 459471362
                     │       │     │      │             │      │     └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000002A8488C79C0>
                     │       │     │      │             │      └ <class 'root.db.models.State'>
                     │       │     │      │             └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       │     │      └ <class 'root.db.models.State'>
                     │       │     └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       └ <function Session.query at 0x000002A847812660>
                     └ <sqlalchemy.orm.session.Session object at 0x000002A86AF03850>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x000002A84778CFE0>
           └ <sqlalchemy.orm.query.Query object at 0x000002A869862510>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x000002A847811580>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x000002A86AF03850>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x000002A869DE2C10>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002A847811300>
           └ <sqlalchemy.orm.session.Session object at 0x000002A86AF03850>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000002A8476AF240>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000002A8468BD940>
             └ <sqlalchemy.engine.base.Connection object at 0x000002A869D50050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002A86AF54790>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002A8468BDC60>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A869D50050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002A8468BDE40>
          └ <sqlalchemy.engine.base.Connection object at 0x000002A869D50050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002A8468BDEE0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A869D50050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002A8468BE160>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A869D50050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE states.client_tg_id = 459471362 \n    ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE sta...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A846988D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A8489A50D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A869D50050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A86D503220; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-06-23T10:37:10.181536+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task 
FROM tasks 
WHERE tasks.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A846988D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A8489A50D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A802DF4910>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task \nFROM tasks \nWHERE tasks.client_...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A869E19700; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000002A8698E3F60>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>
    │        └ <function start_polling at 0x000002A847525C60>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000002A8475267A0>
    └ <aiogram.utils.executor.Executor object at 0x000002A8698EE250>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000002A845889B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002A8457DB9C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002A8457018A0>
    └ <Handle <TaskStepMethWrapper object at 0x000002A802DF0130>()>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002A802DF0130>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002A802DF0130>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002A802DF0130>()>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641882, "message": {"message_id": 843, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000002A8471FF3D0>
                 │    │                │      └ <Update {"update_id": 56641882, "message": {"message_id": 843, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000002A84742DEE0>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000002A848B71ED0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000002A869862850>}
                     │           │        └ (<Message {"message_id": 843, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000002A8698E1580>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000002A8698E1580>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 313, in check_task
    models.Task.client_tg_id == message.from_user.id).first().current_task
    │      │    │               │       └ <aiogram.types.fields.Field object at 0x000002A847131B50>
    │      │    │               └ <Message {"message_id": 843, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ⁽...
    │      │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000002A8488C6E80>
    │      └ <class 'root.db.models.Task'>
    └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x000002A84778CFE0>
           └ <sqlalchemy.orm.query.Query object at 0x000002A802DF41D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x000002A847811580>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x000002A86C0CF2D0>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x000002A804FE9550>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002A847811300>
           └ <sqlalchemy.orm.session.Session object at 0x000002A86C0CF2D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000002A8476AF240>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000002A8468BD940>
             └ <sqlalchemy.engine.base.Connection object at 0x000002A802DF4910>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002A802DF47D0>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002A8468BDC60>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A802DF4910>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002A8468BDE40>
          └ <sqlalchemy.engine.base.Connection object at 0x000002A802DF4910>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002A8468BDEE0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A802DF4910>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002A8468BE160>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A802DF4910>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE tasks.client_tg_id = 459471362 \n     ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE tas...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A846988D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A8489A50D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A802DF4910>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task \nFROM tasks \nWHERE tasks.client_...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A869E19700; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task 
FROM tasks 
WHERE tasks.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-06-23T10:37:10.339938+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A846988D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A8489A50D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A804729F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A86D28C820; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000002A8698E3F60>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>
    │        └ <function start_polling at 0x000002A847525C60>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000002A8475267A0>
    └ <aiogram.utils.executor.Executor object at 0x000002A8698EE250>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000002A845889B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002A8457DB9C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002A8457018A0>
    └ <Handle <TaskStepMethWrapper object at 0x000002A802DF0130>()>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002A802DF0130>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002A802DF0130>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002A802DF0130>()>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641882, "message": {"message_id": 843, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000002A8471FF3D0>
                 │    │                │      └ <Update {"update_id": 56641882, "message": {"message_id": 843, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000002A84742DEE0>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000002A848B71ED0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000002A869862850>}
                     │           │        └ (<Message {"message_id": 843, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000002A8698E1580>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000002A8698E1580>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 334, in check_task
    await delete_state_from_db(message.from_user.id)
          │                    │       └ <aiogram.types.fields.Field object at 0x000002A847131B50>
          │                    └ <Message {"message_id": 843, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ⁽...
          └ <function delete_state_from_db at 0x000002A8698C6FC0>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 69, in delete_state_from_db
    existing_state = session.query(models.State).filter(models.State.client_tg_id == user_id).first()
                     │       │     │      │             │      │     │               └ 459471362
                     │       │     │      │             │      │     └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000002A8488C79C0>
                     │       │     │      │             │      └ <class 'root.db.models.State'>
                     │       │     │      │             └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       │     │      └ <class 'root.db.models.State'>
                     │       │     └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       └ <function Session.query at 0x000002A847812660>
                     └ <sqlalchemy.orm.session.Session object at 0x000002A86C5370D0>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x000002A84778CFE0>
           └ <sqlalchemy.orm.query.Query object at 0x000002A804729B50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x000002A847811580>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x000002A86C5370D0>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x000002A802DF48D0>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002A847811300>
           └ <sqlalchemy.orm.session.Session object at 0x000002A86C5370D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000002A8476AF240>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000002A8468BD940>
             └ <sqlalchemy.engine.base.Connection object at 0x000002A804729F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002A804729DD0>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002A8468BDC60>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A804729F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002A8468BDE40>
          └ <sqlalchemy.engine.base.Connection object at 0x000002A804729F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002A8468BDEE0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A804729F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002A8468BE160>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A804729F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE states.client_tg_id = 459471362 \n    ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE sta...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A846988D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A8489A50D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A804729F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A86D28C820; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-06-23T10:37:42.548401+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task 
FROM tasks 
WHERE tasks.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A846988D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A8489A50D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A86C612650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task \nFROM tasks \nWHERE tasks.client_...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A86D5018C0; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000002A8698E3F60>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>
    │        └ <function start_polling at 0x000002A847525C60>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000002A8475267A0>
    └ <aiogram.utils.executor.Executor object at 0x000002A8698EE250>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000002A845889B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002A8457DB9C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002A8457018A0>
    └ <Handle <TaskStepMethWrapper object at 0x000002A86FD1ABF0>()>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002A86FD1ABF0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002A86FD1ABF0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002A86FD1ABF0>()>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641883, "message": {"message_id": 844, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000002A8471FF3D0>
                 │    │                │      └ <Update {"update_id": 56641883, "message": {"message_id": 844, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000002A84742DEE0>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000002A848B71ED0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000002A804806B50>}
                     │           │        └ (<Message {"message_id": 844, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000002A8698E1580>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000002A8698E1580>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 313, in check_task
    models.Task.client_tg_id == message.from_user.id).first().current_task
    │      │    │               │       └ <aiogram.types.fields.Field object at 0x000002A847131B50>
    │      │    │               └ <Message {"message_id": 844, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ⁽...
    │      │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000002A8488C6E80>
    │      └ <class 'root.db.models.Task'>
    └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x000002A84778CFE0>
           └ <sqlalchemy.orm.query.Query object at 0x000002A802DEBD10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x000002A847811580>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x000002A87513EAD0>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x000002A87513EB50>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002A847811300>
           └ <sqlalchemy.orm.session.Session object at 0x000002A87513EAD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000002A8476AF240>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000002A8468BD940>
             └ <sqlalchemy.engine.base.Connection object at 0x000002A86C612650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002A80626CD90>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002A8468BDC60>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A86C612650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002A8468BDE40>
          └ <sqlalchemy.engine.base.Connection object at 0x000002A86C612650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002A8468BDEE0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A86C612650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002A8468BE160>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A86C612650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE tasks.client_tg_id = 459471362 \n     ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE tas...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A846988D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A8489A50D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A86C612650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task \nFROM tasks \nWHERE tasks.client_...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A86D5018C0; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task 
FROM tasks 
WHERE tasks.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-06-23T10:37:42.564851+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A846988D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A8489A50D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A86C5C9F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A86D502420; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000002A8698E3F60>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>
    │        └ <function start_polling at 0x000002A847525C60>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000002A8475267A0>
    └ <aiogram.utils.executor.Executor object at 0x000002A8698EE250>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000002A845889B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002A8457DB9C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002A8457018A0>
    └ <Handle <TaskStepMethWrapper object at 0x000002A86FD1ABF0>()>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002A86FD1ABF0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002A86FD1ABF0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002A86FD1ABF0>()>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641883, "message": {"message_id": 844, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000002A8471FF3D0>
                 │    │                │      └ <Update {"update_id": 56641883, "message": {"message_id": 844, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000002A84742DEE0>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000002A848B71ED0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000002A804806B50>}
                     │           │        └ (<Message {"message_id": 844, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000002A8698E1580>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000002A8698E1580>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 334, in check_task
    await delete_state_from_db(message.from_user.id)
          │                    │       └ <aiogram.types.fields.Field object at 0x000002A847131B50>
          │                    └ <Message {"message_id": 844, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ⁽...
          └ <function delete_state_from_db at 0x000002A8698C6FC0>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 69, in delete_state_from_db
    existing_state = session.query(models.State).filter(models.State.client_tg_id == user_id).first()
                     │       │     │      │             │      │     │               └ 459471362
                     │       │     │      │             │      │     └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000002A8488C79C0>
                     │       │     │      │             │      └ <class 'root.db.models.State'>
                     │       │     │      │             └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       │     │      └ <class 'root.db.models.State'>
                     │       │     └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       └ <function Session.query at 0x000002A847812660>
                     └ <sqlalchemy.orm.session.Session object at 0x000002A86AF31C10>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x000002A84778CFE0>
           └ <sqlalchemy.orm.query.Query object at 0x000002A80626CC50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x000002A847811580>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x000002A86AF31C10>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x000002A86B0993D0>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002A847811300>
           └ <sqlalchemy.orm.session.Session object at 0x000002A86AF31C10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000002A8476AF240>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000002A8468BD940>
             └ <sqlalchemy.engine.base.Connection object at 0x000002A86C5C9F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002A86C611D90>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002A8468BDC60>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A86C5C9F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002A8468BDE40>
          └ <sqlalchemy.engine.base.Connection object at 0x000002A86C5C9F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002A8468BDEE0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A86C5C9F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002A8468BE160>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A86C5C9F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE states.client_tg_id = 459471362 \n    ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE sta...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A846988D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A8489A50D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A86C5C9F90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A86D502420; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-06-23T10:38:22.042342+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A846988D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A8489A50D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A86CAE9C90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A86D28FA00; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000002A8698E3F60>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>
    │        └ <function start_polling at 0x000002A847525C60>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000002A8475267A0>
    └ <aiogram.utils.executor.Executor object at 0x000002A8698EE250>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000002A845889B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002A8457DB9C0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002A8457018A0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641886, "message": {"message_id": 850, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000002A8471FF3D0>
                 │    │                │      └ <Update {"update_id": 56641886, "message": {"message_id": 850, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000002A84742DEE0>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000002A848B71ED0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002A848B71D50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000002A86C61ED90>}
                     │           │        └ (<Message {"message_id": 850, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000002A8698E0A40>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000002A8698E0A40>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 225, in check_task
    await delete_state_from_db(message.from_user.id)
          │                    │       └ <aiogram.types.fields.Field object at 0x000002A847131B50>
          │                    └ <Message {"message_id": 850, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ⁽...
          └ <function delete_state_from_db at 0x000002A8698C6FC0>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 69, in delete_state_from_db
    existing_state = session.query(models.State).filter(models.State.client_tg_id == user_id).first()
                     │       │     │      │             │      │     │               └ 459471362
                     │       │     │      │             │      │     └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000002A8488C79C0>
                     │       │     │      │             │      └ <class 'root.db.models.State'>
                     │       │     │      │             └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       │     │      └ <class 'root.db.models.State'>
                     │       │     └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>
                     │       └ <function Session.query at 0x000002A847812660>
                     └ <sqlalchemy.orm.session.Session object at 0x000002A86C610810>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x000002A84778CFE0>
           └ <sqlalchemy.orm.query.Query object at 0x000002A86CAEB590>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x000002A847811580>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x000002A86C610810>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x000002A86AF8DAD0>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002A847811300>
           └ <sqlalchemy.orm.session.Session object at 0x000002A86C610810>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000002A8476AF240>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000002A8468BD940>
             └ <sqlalchemy.engine.base.Connection object at 0x000002A86CAE9C90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002A86CAEAAD0>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002A8468BDC60>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A86CAE9C90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002A8468BDE40>
          └ <sqlalchemy.engine.base.Connection object at 0x000002A86CAE9C90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002A8468BDEE0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A86CAE9C90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002A8468BE160>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A86CAE9C90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE states.client_tg_id = 459471362 \n    ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE sta...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A846988D60>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A8489A50D0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A86CAE9C90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state \nFROM states \nWHERE states...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A86D28FA00; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE states.client_tg_id = 459471362 
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT states.client_tg_id AS states_client_tg_id, states.current_state AS states_current_state 
FROM states 
WHERE states.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-06-23T10:40:53.819160+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task 
FROM tasks 
WHERE tasks.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000025678838CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002567A854CD0>
    └ <sqlalchemy.engine.base.Connection object at 0x00000256269C8CD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task \nFROM tasks \nWHERE tasks.client_...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002561B78A6C0; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000002561B783EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002567AA22050>
    │        └ <function start_polling at 0x00000256793D9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000256793DA700>
    └ <aiogram.utils.executor.Executor object at 0x000002567F510C10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x0000025677749A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002567769B920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000256775D1800>
    └ <Handle <TaskStepMethWrapper object at 0x00000256269AE140>()>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x00000256269AE140>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x00000256269AE140>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x00000256269AE140>()>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641894, "message": {"message_id": 875, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002567AA22050>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x00000256790AF550>
                 │    │                │      └ <Update {"update_id": 56641894, "message": {"message_id": 875, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x00000256792DDE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000002561B69A3D0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002567AA22050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000002561DE42B10>}
                     │           │        └ (<Message {"message_id": 875, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000002561B7814E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000002561B7814E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 313, in check_task
    models.Task.client_tg_id == message.from_user.id).first().current_task
    │      │    │               │       └ <aiogram.types.fields.Field object at 0x0000025678FE1C10>
    │      │    │               └ <Message {"message_id": 875, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ⁽...
    │      │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000002567A776DE0>
    │      └ <class 'root.db.models.Task'>
    └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x000002567963CF40>
           └ <sqlalchemy.orm.query.Query object at 0x00000256269C8950>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x00000256796C14E0>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x000002561D169BD0>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x000002561D169AD0>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x00000256796C1260>
           └ <sqlalchemy.orm.session.Session object at 0x000002561D169BD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000002567955F1A0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000002567876D8A0>
             └ <sqlalchemy.engine.base.Connection object at 0x00000256269C8CD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x00000256269C8B50>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002567876DBC0>
           └ <sqlalchemy.engine.base.Connection object at 0x00000256269C8CD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002567876DDA0>
          └ <sqlalchemy.engine.base.Connection object at 0x00000256269C8CD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002567876DE40>
           └ <sqlalchemy.engine.base.Connection object at 0x00000256269C8CD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002567876E0C0>
    └ <sqlalchemy.engine.base.Connection object at 0x00000256269C8CD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE tasks.client_tg_id = 459471362 \n     ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE tas...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000025678838CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002567A854CD0>
    └ <sqlalchemy.engine.base.Connection object at 0x00000256269C8CD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task \nFROM tasks \nWHERE tasks.client_...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002561B78A6C0; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task 
FROM tasks 
WHERE tasks.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-06-23T10:41:06.207773+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task 
FROM tasks 
WHERE tasks.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000025678838CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002567A854CD0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002562BA05150>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task \nFROM tasks \nWHERE tasks.client_...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002561BB97760; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000002561B783EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002567AA22050>
    │        └ <function start_polling at 0x00000256793D9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000256793DA700>
    └ <aiogram.utils.executor.Executor object at 0x000002567F510C10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x0000025677749A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002567769B920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000256775D1800>
    └ <Handle <TaskStepMethWrapper object at 0x0000025621423F70>()>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000025621423F70>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000025621423F70>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000025621423F70>()>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641895, "message": {"message_id": 877, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002567AA22050>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x00000256790AF550>
                 │    │                │      └ <Update {"update_id": 56641895, "message": {"message_id": 877, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x00000256792DDE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000002561B69A3D0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002567AA22050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000002561DE926D0>}
                     │           │        └ (<Message {"message_id": 877, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000002561B7814E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000002561B7814E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 313, in check_task
    models.Task.client_tg_id == message.from_user.id).first().current_task
    │      │    │               │       └ <aiogram.types.fields.Field object at 0x0000025678FE1C10>
    │      │    │               └ <Message {"message_id": 877, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ⁽...
    │      │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000002567A776DE0>
    │      └ <class 'root.db.models.Task'>
    └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x000002567963CF40>
           └ <sqlalchemy.orm.query.Query object at 0x00000256269C8B10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x00000256796C14E0>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x000002561E220FD0>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x00000256269C8B90>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x00000256796C1260>
           └ <sqlalchemy.orm.session.Session object at 0x000002561E220FD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000002567955F1A0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000002567876D8A0>
             └ <sqlalchemy.engine.base.Connection object at 0x000002562BA05150>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x00000256277623D0>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002567876DBC0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002562BA05150>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002567876DDA0>
          └ <sqlalchemy.engine.base.Connection object at 0x000002562BA05150>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002567876DE40>
           └ <sqlalchemy.engine.base.Connection object at 0x000002562BA05150>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002567876E0C0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002562BA05150>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE tasks.client_tg_id = 459471362 \n     ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE tas...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000025678838CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002567A854CD0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002562BA05150>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task \nFROM tasks \nWHERE tasks.client_...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002561BB97760; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task 
FROM tasks 
WHERE tasks.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-06-23T10:41:06.367220+0300 ERROR Class 'builtins.NoneType' is not mapped
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3382, in delete
    state = attributes.instance_state(instance)
            │          │              └ None
            │          └ operator.attrgetter('_sa_instance_state')
            └ <module 'sqlalchemy.orm.attributes' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\att...

AttributeError: 'NoneType' object has no attribute '_sa_instance_state'


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000002561B783EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002567AA22050>
    │        └ <function start_polling at 0x00000256793D9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000256793DA700>
    └ <aiogram.utils.executor.Executor object at 0x000002567F510C10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x0000025677749A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002567769B920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000256775D1800>
    └ <Handle <TaskStepMethWrapper object at 0x0000025621423F70>()>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000025621423F70>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000025621423F70>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000025621423F70>()>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641895, "message": {"message_id": 877, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002567AA22050>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x00000256790AF550>
                 │    │                │      └ <Update {"update_id": 56641895, "message": {"message_id": 877, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x00000256792DDE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000002561B69A3D0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002567AA22050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000002561DE926D0>}
                     │           │        └ (<Message {"message_id": 877, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000002561B7814E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000002561B7814E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 334, in check_task
    await delete_state_from_db(message.from_user.id)
          │                    │       └ <aiogram.types.fields.Field object at 0x0000025678FE1C10>
          │                    └ <Message {"message_id": 877, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ⁽...
          └ <function delete_state_from_db at 0x000002561B766F20>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 70, in delete_state_from_db
    session.delete(existing_state)
    │       │      └ None
    │       └ <function Session.delete at 0x00000256796C3100>
    └ <sqlalchemy.orm.session.Session object at 0x000002562BA04F10>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3384, in delete
    raise exc.UnmappedInstanceError(instance) from err
          │   │                     └ None
          │   └ <class 'sqlalchemy.orm.exc.UnmappedInstanceError'>
          └ <module 'sqlalchemy.orm.exc' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\exc.py'>

sqlalchemy.orm.exc.UnmappedInstanceError: Class 'builtins.NoneType' is not mapped
2023-06-23T10:42:07.661321+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task 
FROM tasks 
WHERE tasks.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000025678838CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002567A854CD0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002561FB095D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task \nFROM tasks \nWHERE tasks.client_...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000256224CC740; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000002561B783EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002567AA22050>
    │        └ <function start_polling at 0x00000256793D9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000256793DA700>
    └ <aiogram.utils.executor.Executor object at 0x000002567F510C10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x0000025677749A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002567769B920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000256775D1800>
    └ <Handle <TaskStepMethWrapper object at 0x000002562DFCCA90>()>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002562DFCCA90>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002562DFCCA90>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002562DFCCA90>()>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641901, "message": {"message_id": 894, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002567AA22050>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x00000256790AF550>
                 │    │                │      └ <Update {"update_id": 56641901, "message": {"message_id": 894, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x00000256792DDE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000002561B69A3D0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000002567AA22050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000002561F7C9D50>}
                     │           │        └ (<Message {"message_id": 894, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000002561B7814E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000002561B7814E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 313, in check_task
    models.Task.client_tg_id == message.from_user.id).first().current_task
    │      │    │               │       └ <aiogram.types.fields.Field object at 0x0000025678FE1C10>
    │      │    │               └ <Message {"message_id": 894, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ⁽...
    │      │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000002567A776DE0>
    │      └ <class 'root.db.models.Task'>
    └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2743, in first
    return self.limit(1)._iter().first()  # type: ignore
           │    └ <function Query.limit at 0x000002567963CF40>
           └ <sqlalchemy.orm.query.Query object at 0x0000025624634ED0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x00000256796C14E0>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x0000025624636C10>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x0000025624637990>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x00000256796C1260>
           └ <sqlalchemy.orm.session.Session object at 0x0000025624636C10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000002567955F1A0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000002567876D8A0>
             └ <sqlalchemy.engine.base.Connection object at 0x000002561FB095D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002562FAB0D10>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002567876DBC0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002561FB095D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002567876DDA0>
          └ <sqlalchemy.engine.base.Connection object at 0x000002561FB095D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002567876DE40>
           └ <sqlalchemy.engine.base.Connection object at 0x000002561FB095D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002567876E0C0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002561FB095D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction('operator does not exist: character varying = integer\nLINE 3: WHERE tasks.client_tg_id = 459471362 \n     ...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction('operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: WHERE tas...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000025678838CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002567A854CD0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002561FB095D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'client_tg_id_1': 459471362, 'param_1': 1}
    │      │       └ 'SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task \nFROM tasks \nWHERE tasks.client_...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000256224CC740; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: WHERE tasks.client_tg_id = 459471362 
                                 ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT tasks.client_tg_id AS tasks_client_tg_id, tasks.current_task AS tasks_current_task 
FROM tasks 
WHERE tasks.client_tg_id = %(client_tg_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'client_tg_id_1': 459471362, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-06-23T10:43:56.692005+0300 ERROR (psycopg2.ProgrammingError) can't adapt type 'MessageId'
[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 983672566, 'receiver_id': 459471362, 'task_number': 1, 'message_id': <MessageId {"message_id": 915}>}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000025EB4B18CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000025EB6B349D0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000025EE8F9C310>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 983672566, 'receiver_id': 459471362, 'task_number': 1, 'message_id': <MessageId {"message_id": 915}>}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000025EE962F840; closed: -1>

psycopg2.ProgrammingError: can't adapt type 'MessageId'


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x0000025ED7A63EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0000025ED5A14ED0>
    │        └ <function start_polling at 0x0000025EB56B9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x0000025EB56BA700>
    └ <aiogram.utils.executor.Executor object at 0x0000025ED7A6E690>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x0000025EB3A1DA80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000025EB3967920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000025EB3891800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641909, "message": {"message_id": 913, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0000025ED5A14ED0>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x0000025EB538F090>
                 │    │                │      └ <Update {"update_id": 56641909, "message": {"message_id": 913, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x0000025EB55BDE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x0000025ED60F8410>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0000025ED5A14ED0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x0000025EDA49ED50>}
                     │           │        └ (<Message {"message_id": 913, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x0000025ED7A614E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x0000025ED7A614E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 323, in check_task
    session.commit()
    │       └ <function Session.commit at 0x0000025EB59A0E00>
    └ <sqlalchemy.orm.session.Session object at 0x0000025EDA4A5D10>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1905, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x0000025EB5997F60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000025EE8F83020>
  File "<string>", line 2, in commit
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000025EE8F83020>
                └ <function SessionTransaction.commit at 0x0000025EB5997D80>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1220, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x0000025EB5997C40>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000025EE8F83020>
  File "<string>", line 2, in _prepare_impl
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000025EE8F83020>
                └ <function SessionTransaction._prepare_impl at 0x0000025EB5997BA0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1195, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x0000025EB59A3B00>
    │    └ <sqlalchemy.orm.session.Session object at 0x0000025EDA4A5D10>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000025EE8F83020>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4153, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x0000025EB59A3CE0>
    └ <sqlalchemy.orm.session.Session object at 0x0000025EDA4A5D10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4289, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000025EDA593B00>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError("(psycopg2.ProgrammingError) can't adapt type 'MessageId'")
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4250, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x0000025EB59947C0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000025EE99B6A10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 467, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000025EE99B6A10>
    │   └ <function SaveUpdateAll.execute at 0x0000025EB5995300>
    └ SaveUpdateAll(Mapper[NotCheckedTask(not_checked_tasks)])
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 644, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x0000025EB591F4C0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\pe...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\pr...
    └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x0000025EB5943560>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1040, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x0000025EB4A4D8A0>
             └ <sqlalchemy.engine.base.Connection object at 0x0000025EE8F9C310>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x0000025EE92B5F10>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000025EB4A4DBC0>
           └ <sqlalchemy.engine.base.Connection object at 0x0000025EE8F9C310>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000025EB4A4DDA0>
          └ <sqlalchemy.engine.base.Connection object at 0x0000025EE8F9C310>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000025EB4A4DE40>
           └ <sqlalchemy.engine.base.Connection object at 0x0000025EE8F9C310>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000025EB4A4E0C0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000025EE8F9C310>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ ProgrammingError("can't adapt type 'MessageId'")
          │                    │              └ (<class 'psycopg2.ProgrammingError'>, ProgrammingError("can't adapt type 'MessageId'"), <traceback object at 0x0000025EDA5937...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError("(psycopg2.ProgrammingError) can't adapt type 'MessageId'")
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000025EB4B18CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000025EB6B349D0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000025EE8F9C310>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 983672566, 'receiver_id': 459471362, 'task_number': 1, 'message_id': <MessageId {"message_id": 915}>}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000025EE962F840; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.ProgrammingError) can't adapt type 'MessageId'
[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 983672566, 'receiver_id': 459471362, 'task_number': 1, 'message_id': <MessageId {"message_id": 915}>}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-06-23T10:47:55.816309+0300 ERROR (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 459471362, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 940}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000020B3E368CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000020B40384ED0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000020B706CD650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 459471362, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 940}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000020B61D027A0; closed: -1>

psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x0000020B612B3EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0000020B611A2690>
    │        └ <function start_polling at 0x0000020B3EF09BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x0000020B3EF0A700>
    └ <aiogram.utils.executor.Executor object at 0x0000020B612BDD90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x0000020B3D269A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020B3D1BB920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020B3CCE1800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641916, "message": {"message_id": 935, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0000020B611A2690>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x0000020B3EBDB610>
                 │    │                │      └ <Update {"update_id": 56641916, "message": {"message_id": 935, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x0000020B3EE0DE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x0000020B5F249B10>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0000020B611A2690>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x0000020B7020BB90>}
                     │           │        └ (<Message {"message_id": 935, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x0000020B612B14E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x0000020B612B14E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 323, in check_task
    session.commit()
    │       └ <function Session.commit at 0x0000020B3F1F0E00>
    └ <sqlalchemy.orm.session.Session object at 0x0000020B7020BD10>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1905, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x0000020B3F1E7F60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000020B6D07ED50>
  File "<string>", line 2, in commit
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000020B6D07ED50>
                └ <function SessionTransaction.commit at 0x0000020B3F1E7D80>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1220, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x0000020B3F1E7C40>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000020B6D07ED50>
  File "<string>", line 2, in _prepare_impl
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000020B6D07ED50>
                └ <function SessionTransaction._prepare_impl at 0x0000020B3F1E7BA0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1195, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x0000020B3F1F3B00>
    │    └ <sqlalchemy.orm.session.Session object at 0x0000020B7020BD10>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000020B6D07ED50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4153, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x0000020B3F1F3CE0>
    └ <sqlalchemy.orm.session.Session object at 0x0000020B7020BD10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4289, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000020B706CEC00>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4250, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x0000020B3F1E47C0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000020B70232610>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 467, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000020B70232610>
    │   └ <function SaveUpdateAll.execute at 0x0000020B3F1E5300>
    └ SaveUpdateAll(Mapper[NotCheckedTask(not_checked_tasks)])
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 644, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x0000020B3F16F4C0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\pe...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\pr...
    └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x0000020B3F193560>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1040, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x0000020B3E29D8A0>
             └ <sqlalchemy.engine.base.Connection object at 0x0000020B706CD650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x0000020B70260B90>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000020B3E29DBC0>
           └ <sqlalchemy.engine.base.Connection object at 0x0000020B706CD650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000020B3E29DDA0>
          └ <sqlalchemy.engine.base.Connection object at 0x0000020B706CD650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000020B3E29DE40>
           └ <sqlalchemy.engine.base.Connection object at 0x0000020B706CD650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000020B3E29E0C0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000020B706CD650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UniqueViolation('duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDETAIL:  Key (receiver_id, task_num...
          │                    │              └ (<class 'psycopg2.errors.UniqueViolation'>, UniqueViolation('duplicate key value violates unique constraint "not_checked_task...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000020B3E368CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000020B40384ED0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000020B706CD650>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 459471362, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 940}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000020B61D027A0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 459471362, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 940}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2023-06-23T10:48:04.244772+0300 ERROR (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: ...eiver_id = '459471362' AND not_checked_tasks.task_number = 1
                                                                    ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT not_checked_tasks.admin_id AS not_checked_tasks_admin_id, not_checked_tasks.receiver_id AS not_checked_tasks_receiver_id, not_checked_tasks.task_number AS not_checked_tasks_task_number, not_checked_tasks.message_id AS not_checked_tasks_message_id 
FROM not_checked_tasks 
WHERE not_checked_tasks.receiver_id = %(receiver_id_1)s AND not_checked_tasks.task_number = %(task_number_1)s]
[parameters: {'receiver_id_1': '459471362', 'task_number_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000020B3E368CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000020B40384ED0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000020B62548050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'receiver_id_1': '459471362', 'task_number_1': 1}
    │      │       └ 'SELECT not_checked_tasks.admin_id AS not_checked_tasks_admin_id, not_checked_tasks.receiver_id AS not_checked_tasks_receiver...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000020B613274C0; closed: -1>

psycopg2.errors.UndefinedFunction: operator does not exist: character varying = integer
LINE 3: ...eiver_id = '459471362' AND not_checked_tasks.task_number = 1
                                                                    ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x0000020B612B3EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0000020B611A2690>
    │        └ <function start_polling at 0x0000020B3EF09BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x0000020B3EF0A700>
    └ <aiogram.utils.executor.Executor object at 0x0000020B612BDD90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x0000020B3D269A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020B3D1BB920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020B3CCE1800>
    └ <Handle <TaskStepMethWrapper object at 0x0000020B74D36EF0>()>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000020B74D36EF0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000020B74D36EF0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000020B74D36EF0>()>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641917, "callback_query": {"id": "3804320969825963683", "from": {"id": 885762500, "is_bot": false, "...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0000020B611A2690>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in process_update
    return await self.callback_query_handlers.notify(update.callback_query)
                 │    │                       │      │      └ <aiogram.types.fields.Field object at 0x0000020B3EBDB790>
                 │    │                       │      └ <Update {"update_id": 56641917, "callback_query": {"id": "3804320969825963683", "from": {"id": 885762500, "is_bot": false, "f...
                 │    │                       └ <function Handler.notify at 0x0000020B3EE0DE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x0000020B40554C10>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0000020B611A2690>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'callback_data': {'@': 'Acc', 'receiver_id': '459471362'}}
                     │           │        └ (<CallbackQuery {"id": "3804320969825963683", "from": {"id": 885762500, "is_bot": false, "first_name": "ilya", "username": "s...
                     │           └ <function accept_task at 0x0000020B612B1800>
                     └ Handler.HandlerObj(handler=<function accept_task at 0x0000020B612B1800>, spec=FullArgSpec(args=['callback_query', 'callback_d...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 350, in accept_task
    models.NotCheckedTask.task_number == task.current_task).all()
    │      │              │              │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x0000020B402A6E80>
    │      │              │              └ <root.db.models.Task object at 0x0000020B62548690>
    │      │              └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x0000020B402D1580>
    │      └ <class 'root.db.models.NotCheckedTask'>
    └ <module 'root.db.models' from 'C:\\xStorage\\Projects\\PrometeyBot\\root\\db\\models.py'>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2688, in all
    return self._iter().all()  # type: ignore
           │    └ <function Query._iter at 0x0000020B3F16DC60>
           └ <sqlalchemy.orm.query.Query object at 0x0000020B62548DD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
            │                  │    │      │      │    │       └ <function Session.execute at 0x0000020B3F1F14E0>
            │                  │    │      │      │    └ <sqlalchemy.orm.session.Session object at 0x0000020B63D06250>
            │                  │    │      │      └ <sqlalchemy.orm.query.Query object at 0x0000020B62548DD0>
            │                  │    │      └ ~_T
            │                  │    └ <class 'sqlalchemy.engine.result.Result'>
            │                  └ ~_T
            └ typing.Union
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2231, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000020B3F1F1260>
           └ <sqlalchemy.orm.session.Session object at 0x0000020B63D06250>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x0000020B3F08F1A0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 292, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000020B3E29D8A0>
             └ <sqlalchemy.engine.base.Connection object at 0x0000020B62548050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x0000020B62549250>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000020B3E29DBC0>
           └ <sqlalchemy.engine.base.Connection object at 0x0000020B62548050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000020B3E29DDA0>
          └ <sqlalchemy.engine.base.Connection object at 0x0000020B62548050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000020B3E29DE40>
           └ <sqlalchemy.engine.base.Connection object at 0x0000020B62548050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000020B3E29E0C0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000020B62548050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedFunction("operator does not exist: character varying = integer\nLINE 3: ...eiver_id = '459471362' AND not_checked_ta...
          │                    │              └ (<class 'psycopg2.errors.UndefinedFunction'>, UndefinedFunction("operator does not exist: character varying = integer\nLINE 3...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError("(psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer\nLINE 3: ...eiver_...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000020B3E368CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000020B40384ED0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000020B62548050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'receiver_id_1': '459471362', 'task_number_1': 1}
    │      │       └ 'SELECT not_checked_tasks.admin_id AS not_checked_tasks_admin_id, not_checked_tasks.receiver_id AS not_checked_tasks_receiver...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000020B613274C0; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = integer
LINE 3: ...eiver_id = '459471362' AND not_checked_tasks.task_number = 1
                                                                    ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT not_checked_tasks.admin_id AS not_checked_tasks_admin_id, not_checked_tasks.receiver_id AS not_checked_tasks_receiver_id, not_checked_tasks.task_number AS not_checked_tasks_task_number, not_checked_tasks.message_id AS not_checked_tasks_message_id 
FROM not_checked_tasks 
WHERE not_checked_tasks.receiver_id = %(receiver_id_1)s AND not_checked_tasks.task_number = %(task_number_1)s]
[parameters: {'receiver_id_1': '459471362', 'task_number_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-06-23T10:50:35.088775+0300 ERROR (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 961}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000015228C18CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001522AC34B90>
    └ <sqlalchemy.engine.base.Connection object at 0x00000152554EB190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 961}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000152555A8D60; closed: -1>

psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001524BB63EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001524BA136D0>
    │        └ <function start_polling at 0x00000152297B9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000152297BA700>
    └ <aiogram.utils.executor.Executor object at 0x000001524BB6E190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x0000015227B19A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000015227A6B920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000015227991800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641923, "message": {"message_id": 959, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001524BA136D0>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001522948EE50>
                 │    │                │      └ <Update {"update_id": 56641923, "message": {"message_id": 959, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x00000152296BDE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001524A591290>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001524BA136D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001524D239D50>}
                     │           │        └ (<Message {"message_id": 959, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000001524BB614E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000001524BB614E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 323, in check_task
    session.commit()
    │       └ <function Session.commit at 0x0000015229AA0E00>
    └ <sqlalchemy.orm.session.Session object at 0x000001524D211050>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1905, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x0000015229A97F60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001525543F980>
  File "<string>", line 2, in commit
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001525543F980>
                └ <function SessionTransaction.commit at 0x0000015229A97D80>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1220, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x0000015229A97C40>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001525543F980>
  File "<string>", line 2, in _prepare_impl
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001525543F980>
                └ <function SessionTransaction._prepare_impl at 0x0000015229A97BA0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1195, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x0000015229AA3B00>
    │    └ <sqlalchemy.orm.session.Session object at 0x000001524D211050>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001525543F980>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4153, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x0000015229AA3CE0>
    └ <sqlalchemy.orm.session.Session object at 0x000001524D211050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4289, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001524DB6A7C0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4250, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x0000015229A947C0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000015255A553D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 467, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000015255A553D0>
    │   └ <function SaveUpdateAll.execute at 0x0000015229A95300>
    └ SaveUpdateAll(Mapper[NotCheckedTask(not_checked_tasks)])
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 644, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x0000015229A1F4C0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\pe...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\pr...
    └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x0000015229A43560>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1040, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x0000015228B4D8A0>
             └ <sqlalchemy.engine.base.Connection object at 0x00000152554EB190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x00000152565EB7D0>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000015228B4DBC0>
           └ <sqlalchemy.engine.base.Connection object at 0x00000152554EB190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000015228B4DDA0>
          └ <sqlalchemy.engine.base.Connection object at 0x00000152554EB190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000015228B4DE40>
           └ <sqlalchemy.engine.base.Connection object at 0x00000152554EB190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000015228B4E0C0>
    └ <sqlalchemy.engine.base.Connection object at 0x00000152554EB190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UniqueViolation('duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDETAIL:  Key (receiver_id, task_num...
          │                    │              └ (<class 'psycopg2.errors.UniqueViolation'>, UniqueViolation('duplicate key value violates unique constraint "not_checked_task...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000015228C18CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001522AC34B90>
    └ <sqlalchemy.engine.base.Connection object at 0x00000152554EB190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 961}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000152555A8D60; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 961}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2023-06-23T10:50:36.644108+0300 ERROR (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 965}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000015228C18CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001522AC34B90>
    └ <sqlalchemy.engine.base.Connection object at 0x000001524E6C2DD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 965}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000152599D5380; closed: -1>

psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001524BB63EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001524BA136D0>
    │        └ <function start_polling at 0x00000152297B9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000152297BA700>
    └ <aiogram.utils.executor.Executor object at 0x000001524BB6E190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x0000015227B19A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000015227A6B920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000015227991800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641924, "message": {"message_id": 963, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001524BA136D0>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001522948EE50>
                 │    │                │      └ <Update {"update_id": 56641924, "message": {"message_id": 963, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x00000152296BDE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001524A591290>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001524BA136D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001525564E150>}
                     │           │        └ (<Message {"message_id": 963, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000001524BB614E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000001524BB614E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 323, in check_task
    session.commit()
    │       └ <function Session.commit at 0x0000015229AA0E00>
    └ <sqlalchemy.orm.session.Session object at 0x00000152559000D0>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1905, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x0000015229A97F60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000152502EB7A0>
  File "<string>", line 2, in commit
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000152502EB7A0>
                └ <function SessionTransaction.commit at 0x0000015229A97D80>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1220, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x0000015229A97C40>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000152502EB7A0>
  File "<string>", line 2, in _prepare_impl
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000152502EB7A0>
                └ <function SessionTransaction._prepare_impl at 0x0000015229A97BA0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1195, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x0000015229AA3B00>
    │    └ <sqlalchemy.orm.session.Session object at 0x00000152559000D0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000152502EB7A0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4153, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x0000015229AA3CE0>
    └ <sqlalchemy.orm.session.Session object at 0x00000152559000D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4289, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001524E6C8A00>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4250, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x0000015229A947C0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001524E6C3D90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 467, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001524E6C3D90>
    │   └ <function SaveUpdateAll.execute at 0x0000015229A95300>
    └ SaveUpdateAll(Mapper[NotCheckedTask(not_checked_tasks)])
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 644, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x0000015229A1F4C0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\pe...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\pr...
    └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x0000015229A43560>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1040, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x0000015228B4D8A0>
             └ <sqlalchemy.engine.base.Connection object at 0x000001524E6C2DD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x00000152565EB7D0>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000015228B4DBC0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001524E6C2DD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000015228B4DDA0>
          └ <sqlalchemy.engine.base.Connection object at 0x000001524E6C2DD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000015228B4DE40>
           └ <sqlalchemy.engine.base.Connection object at 0x000001524E6C2DD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000015228B4E0C0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001524E6C2DD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UniqueViolation('duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDETAIL:  Key (receiver_id, task_num...
          │                    │              └ (<class 'psycopg2.errors.UniqueViolation'>, UniqueViolation('duplicate key value violates unique constraint "not_checked_task...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000015228C18CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001522AC34B90>
    └ <sqlalchemy.engine.base.Connection object at 0x000001524E6C2DD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 965}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x00000152599D5380; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 965}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2023-06-23T10:50:36.694387+0300 ERROR Class 'builtins.NoneType' is not mapped
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3382, in delete
    state = attributes.instance_state(instance)
            │          │              └ None
            │          └ operator.attrgetter('_sa_instance_state')
            └ <module 'sqlalchemy.orm.attributes' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\att...

AttributeError: 'NoneType' object has no attribute '_sa_instance_state'


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001524BB63EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001524BA136D0>
    │        └ <function start_polling at 0x00000152297B9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000152297BA700>
    └ <aiogram.utils.executor.Executor object at 0x000001524BB6E190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x0000015227B19A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000015227A6B920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000015227991800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641924, "message": {"message_id": 963, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001524BA136D0>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001522948EE50>
                 │    │                │      └ <Update {"update_id": 56641924, "message": {"message_id": 963, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x00000152296BDE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001524A591290>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001524BA136D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001525564E150>}
                     │           │        └ (<Message {"message_id": 963, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000001524BB614E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000001524BB614E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 334, in check_task
    await delete_state_from_db(message.from_user.id)
          │                    │       └ <aiogram.types.fields.Field object at 0x00000152293C1410>
          │                    └ <Message {"message_id": 963, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ⁽...
          └ <function delete_state_from_db at 0x000001524BB46F20>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 70, in delete_state_from_db
    session.delete(existing_state)
    │       │      └ None
    │       └ <function Session.delete at 0x0000015229AA3100>
    └ <sqlalchemy.orm.session.Session object at 0x000001524C062D50>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3384, in delete
    raise exc.UnmappedInstanceError(instance) from err
          │   │                     └ None
          │   └ <class 'sqlalchemy.orm.exc.UnmappedInstanceError'>
          └ <module 'sqlalchemy.orm.exc' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\exc.py'>

sqlalchemy.orm.exc.UnmappedInstanceError: Class 'builtins.NoneType' is not mapped
2023-06-23T10:55:47.092238+0300 ERROR (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 984}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001DD73068CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001DD75048150>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DD18C49750>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 984}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001DD1D307920; closed: -1>

psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001DD15FB3EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001DD15E62710>
    │        └ <function start_polling at 0x000001DD73C09BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000001DD73C0A700>
    └ <aiogram.utils.executor.Executor object at 0x000001DD15FBE750>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000001DD71F89A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001DD71EDB920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001DD71E11800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641930, "message": {"message_id": 982, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001DD15E62710>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001DD738DB010>
                 │    │                │      └ <Update {"update_id": 56641930, "message": {"message_id": 982, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000001DD73B0DE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001DD1463C5D0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001DD15E62710>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001DD18C3AA90>}
                     │           │        └ (<Message {"message_id": 982, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000001DD15FB14E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000001DD15FB14E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 323, in check_task
    session.commit()
    │       └ <function Session.commit at 0x000001DD73EF0E00>
    └ <sqlalchemy.orm.session.Session object at 0x000001DD1D1050D0>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1905, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x000001DD73EE7F60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001DD18C1F520>
  File "<string>", line 2, in commit
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001DD18C1F520>
                └ <function SessionTransaction.commit at 0x000001DD73EE7D80>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1220, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x000001DD73EE7C40>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001DD18C1F520>
  File "<string>", line 2, in _prepare_impl
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001DD18C1F520>
                └ <function SessionTransaction._prepare_impl at 0x000001DD73EE7BA0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1195, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x000001DD73EF3B00>
    │    └ <sqlalchemy.orm.session.Session object at 0x000001DD1D1050D0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001DD18C1F520>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4153, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x000001DD73EF3CE0>
    └ <sqlalchemy.orm.session.Session object at 0x000001DD1D1050D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4289, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001DD23157580>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4250, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x000001DD73EE47C0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001DD18BEAA90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 467, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001DD18BEAA90>
    │   └ <function SaveUpdateAll.execute at 0x000001DD73EE5300>
    └ SaveUpdateAll(Mapper[NotCheckedTask(not_checked_tasks)])
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 644, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x000001DD73E6F4C0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\pe...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\pr...
    └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x000001DD73E93560>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1040, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x000001DD72F9D8A0>
             └ <sqlalchemy.engine.base.Connection object at 0x000001DD18C49750>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x000001DD2307BD90>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001DD72F9DBC0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001DD18C49750>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001DD72F9DDA0>
          └ <sqlalchemy.engine.base.Connection object at 0x000001DD18C49750>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001DD72F9DE40>
           └ <sqlalchemy.engine.base.Connection object at 0x000001DD18C49750>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001DD72F9E0C0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DD18C49750>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UniqueViolation('duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDETAIL:  Key (receiver_id, task_num...
          │                    │              └ (<class 'psycopg2.errors.UniqueViolation'>, UniqueViolation('duplicate key value violates unique constraint "not_checked_task...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001DD73068CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001DD75048150>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DD18C49750>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 984}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001DD1D307920; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 984}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2023-06-23T10:55:54.971626+0300 ERROR (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 989}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001DD73068CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001DD75048150>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DD2A774610>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 989}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001DD1941EA40; closed: -1>

psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001DD15FB3EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001DD15E62710>
    │        └ <function start_polling at 0x000001DD73C09BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000001DD73C0A700>
    └ <aiogram.utils.executor.Executor object at 0x000001DD15FBE750>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000001DD71F89A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001DD71EDB920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001DD71E11800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641931, "message": {"message_id": 987, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001DD15E62710>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001DD738DB010>
                 │    │                │      └ <Update {"update_id": 56641931, "message": {"message_id": 987, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000001DD73B0DE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001DD1463C5D0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001DD15E62710>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001DD18C42F90>}
                     │           │        └ (<Message {"message_id": 987, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000001DD15FB14E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000001DD15FB14E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 323, in check_task
    session.commit()
    │       └ <function Session.commit at 0x000001DD73EF0E00>
    └ <sqlalchemy.orm.session.Session object at 0x000001DD1875D910>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1905, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x000001DD73EE7F60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001DD2AAB9400>
  File "<string>", line 2, in commit
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001DD2AAB9400>
                └ <function SessionTransaction.commit at 0x000001DD73EE7D80>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1220, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x000001DD73EE7C40>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001DD2AAB9400>
  File "<string>", line 2, in _prepare_impl
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001DD2AAB9400>
                └ <function SessionTransaction._prepare_impl at 0x000001DD73EE7BA0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1195, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x000001DD73EF3B00>
    │    └ <sqlalchemy.orm.session.Session object at 0x000001DD1875D910>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001DD2AAB9400>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4153, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x000001DD73EF3CE0>
    └ <sqlalchemy.orm.session.Session object at 0x000001DD1875D910>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4289, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001DD2C61D000>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4250, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x000001DD73EE47C0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001DD15FA0950>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 467, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001DD15FA0950>
    │   └ <function SaveUpdateAll.execute at 0x000001DD73EE5300>
    └ SaveUpdateAll(Mapper[NotCheckedTask(not_checked_tasks)])
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 644, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x000001DD73E6F4C0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\pe...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\pr...
    └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x000001DD73E93560>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1040, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x000001DD72F9D8A0>
             └ <sqlalchemy.engine.base.Connection object at 0x000001DD2A774610>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x000001DD2307BD90>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001DD72F9DBC0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001DD2A774610>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001DD72F9DDA0>
          └ <sqlalchemy.engine.base.Connection object at 0x000001DD2A774610>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001DD72F9DE40>
           └ <sqlalchemy.engine.base.Connection object at 0x000001DD2A774610>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001DD72F9E0C0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DD2A774610>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UniqueViolation('duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDETAIL:  Key (receiver_id, task_num...
          │                    │              └ (<class 'psycopg2.errors.UniqueViolation'>, UniqueViolation('duplicate key value violates unique constraint "not_checked_task...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001DD73068CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001DD75048150>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DD2A774610>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 989}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001DD1941EA40; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 885762500, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 989}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2023-06-23T10:55:55.161597+0300 ERROR Class 'builtins.NoneType' is not mapped
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3382, in delete
    state = attributes.instance_state(instance)
            │          │              └ None
            │          └ operator.attrgetter('_sa_instance_state')
            └ <module 'sqlalchemy.orm.attributes' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\att...

AttributeError: 'NoneType' object has no attribute '_sa_instance_state'


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 622, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001DD15FB3EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001DD15E62710>
    │        └ <function start_polling at 0x000001DD73C09BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000001DD73C0A700>
    └ <aiogram.utils.executor.Executor object at 0x000001DD15FBE750>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000001DD71F89A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001DD71EDB920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001DD71E11800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641931, "message": {"message_id": 987, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001DD15E62710>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001DD738DB010>
                 │    │                │      └ <Update {"update_id": 56641931, "message": {"message_id": 987, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima...
                 │    │                └ <function Handler.notify at 0x000001DD73B0DE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001DD1463C5D0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001DD15E62710>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001DD18C42F90>}
                     │           │        └ (<Message {"message_id": 987, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ...
                     │           └ <function check_task at 0x000001DD15FB14E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000001DD15FB14E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 334, in check_task
    await delete_state_from_db(message.from_user.id)
          │                    │       └ <aiogram.types.fields.Field object at 0x000001DD73811590>
          │                    └ <Message {"message_id": 987, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ ⁽...
          └ <function delete_state_from_db at 0x000001DD15F96F20>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 70, in delete_state_from_db
    session.delete(existing_state)
    │       │      └ None
    │       └ <function Session.delete at 0x000001DD73EF3100>
    └ <sqlalchemy.orm.session.Session object at 0x000001DD1875D950>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3384, in delete
    raise exc.UnmappedInstanceError(instance) from err
          │   │                     └ None
          │   └ <class 'sqlalchemy.orm.exc.UnmappedInstanceError'>
          └ <module 'sqlalchemy.orm.exc' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\exc.py'>

sqlalchemy.orm.exc.UnmappedInstanceError: Class 'builtins.NoneType' is not mapped
2023-06-23T21:13:22.696481+0300 ERROR (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 1357642007, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 1024}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001EEE6A08CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001EEE8A24C50>
    └ <sqlalchemy.engine.base.Connection object at 0x000001EE9F8A3C50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 1357642007, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 1024}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001EE9B1625E0; closed: -1>

psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 629, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001EE89953EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001EE89833C90>
    │        └ <function start_polling at 0x000001EEE75A9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000001EEE75AA700>
    └ <aiogram.utils.executor.Executor object at 0x000001EE8995F190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000001EEE597DA80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001EEE58CB920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001EEE5801800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641942, "message": {"message_id": 1022, "from": {"id": 459471362, "is_bot": false, "first_name": "Di...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001EE89833C90>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001EEE727F210>
                 │    │                │      └ <Update {"update_id": 56641942, "message": {"message_id": 1022, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                 │    │                └ <function Handler.notify at 0x000001EEE74ADE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001EEFF8EBE90>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001EE89833C90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001EE8BCA6D90>}
                     │           │        └ (<Message {"message_id": 1022, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ...
                     │           └ <function check_task at 0x000001EE899514E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000001EE899514E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 326, in check_task
    session_for_new_objects.commit()
    │                       └ <function Session.commit at 0x000001EEE7890E00>
    └ <sqlalchemy.orm.session.Session object at 0x000001EE9A0DB210>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1905, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x000001EEE7887F60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EE9A1F3200>
  File "<string>", line 2, in commit
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EE9A1F3200>
                └ <function SessionTransaction.commit at 0x000001EEE7887D80>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1220, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x000001EEE7887C40>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EE9A1F3200>
  File "<string>", line 2, in _prepare_impl
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EE9A1F3200>
                └ <function SessionTransaction._prepare_impl at 0x000001EEE7887BA0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1195, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x000001EEE7893B00>
    │    └ <sqlalchemy.orm.session.Session object at 0x000001EE9A0DB210>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EE9A1F3200>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4153, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x000001EEE7893CE0>
    └ <sqlalchemy.orm.session.Session object at 0x000001EE9A0DB210>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4289, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001EE9FAE2B40>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4250, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x000001EEE78847C0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001EE8C63D310>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 467, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001EE8C63D310>
    │   └ <function SaveUpdateAll.execute at 0x000001EEE7885300>
    └ SaveUpdateAll(Mapper[NotCheckedTask(not_checked_tasks)])
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 644, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x000001EEE780F4C0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\pe...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\pr...
    └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x000001EEE7833560>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1040, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x000001EEE693D8A0>
             └ <sqlalchemy.engine.base.Connection object at 0x000001EE9F8A3C50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x000001EE9FA2F710>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001EEE693DBC0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001EE9F8A3C50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001EEE693DDA0>
          └ <sqlalchemy.engine.base.Connection object at 0x000001EE9F8A3C50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001EEE693DE40>
           └ <sqlalchemy.engine.base.Connection object at 0x000001EE9F8A3C50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001EEE693E0C0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001EE9F8A3C50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UniqueViolation('duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDETAIL:  Key (receiver_id, task_num...
          │                    │              └ (<class 'psycopg2.errors.UniqueViolation'>, UniqueViolation('duplicate key value violates unique constraint "not_checked_task...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001EEE6A08CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001EEE8A24C50>
    └ <sqlalchemy.engine.base.Connection object at 0x000001EE9F8A3C50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 1357642007, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 1024}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001EE9B1625E0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 1357642007, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 1024}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2023-06-23T21:13:24.356882+0300 ERROR (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 459471362, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 1027}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001EEE6A08CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001EEE8A24C50>
    └ <sqlalchemy.engine.base.Connection object at 0x000001EEA1A1B190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 459471362, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 1027}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001EE9B160AC0; closed: -1>

psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 629, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001EE89953EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001EE89833C90>
    │        └ <function start_polling at 0x000001EEE75A9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000001EEE75AA700>
    └ <aiogram.utils.executor.Executor object at 0x000001EE8995F190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000001EEE597DA80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001EEE58CB920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001EEE5801800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641942, "message": {"message_id": 1022, "from": {"id": 459471362, "is_bot": false, "first_name": "Di...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001EE89833C90>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x000001EEE727F210>
                 │    │                │      └ <Update {"update_id": 56641942, "message": {"message_id": 1022, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                 │    │                └ <function Handler.notify at 0x000001EEE74ADE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001EEFF8EBE90>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001EE89833C90>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x000001EE8BCA6D90>}
                     │           │        └ (<Message {"message_id": 1022, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ...
                     │           └ <function check_task at 0x000001EE899514E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000001EE899514E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 326, in check_task
    session_for_new_objects.commit()
    │                       └ <function Session.commit at 0x000001EEE7890E00>
    └ <sqlalchemy.orm.session.Session object at 0x000001EE95642C50>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1905, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x000001EEE7887F60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EE8D8E89B0>
  File "<string>", line 2, in commit
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EE8D8E89B0>
                └ <function SessionTransaction.commit at 0x000001EEE7887D80>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1220, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x000001EEE7887C40>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EE8D8E89B0>
  File "<string>", line 2, in _prepare_impl
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EE8D8E89B0>
                └ <function SessionTransaction._prepare_impl at 0x000001EEE7887BA0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1195, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x000001EEE7893B00>
    │    └ <sqlalchemy.orm.session.Session object at 0x000001EE95642C50>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001EE8D8E89B0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4153, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x000001EEE7893CE0>
    └ <sqlalchemy.orm.session.Session object at 0x000001EE95642C50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4289, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001EEA1C5DE40>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4250, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x000001EEE78847C0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001EE949A4E10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 467, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x000001EE949A4E10>
    │   └ <function SaveUpdateAll.execute at 0x000001EEE7885300>
    └ SaveUpdateAll(Mapper[NotCheckedTask(not_checked_tasks)])
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 644, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x000001EEE780F4C0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\pe...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\pr...
    └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x000001EEE7833560>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1040, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x000001EEE693D8A0>
             └ <sqlalchemy.engine.base.Connection object at 0x000001EEA1A1B190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x000001EE9FA2F710>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001EEE693DBC0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001EEA1A1B190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001EEE693DDA0>
          └ <sqlalchemy.engine.base.Connection object at 0x000001EEA1A1B190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001EEE693DE40>
           └ <sqlalchemy.engine.base.Connection object at 0x000001EEA1A1B190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001EEE693E0C0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001EEA1A1B190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UniqueViolation('duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDETAIL:  Key (receiver_id, task_num...
          │                    │              └ (<class 'psycopg2.errors.UniqueViolation'>, UniqueViolation('duplicate key value violates unique constraint "not_checked_task...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001EEE6A08CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001EEE8A24C50>
    └ <sqlalchemy.engine.base.Connection object at 0x000001EEA1A1B190>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 459471362, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 1027}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001EE9B160AC0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 459471362, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 1027}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2023-06-23T21:15:14.605457+0300 ERROR (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 459471362, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 1053}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000025E68618CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000025E6A634410>
    └ <sqlalchemy.engine.base.Connection object at 0x0000025E0B471AD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 459471362, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 1053}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000025E1A0459A0; closed: -1>

psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 629, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x0000025E0B573EC0>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0000025E7F514A50>
    │        └ <function start_polling at 0x0000025E691B9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x0000025E691BA700>
    └ <aiogram.utils.executor.Executor object at 0x0000025E0B4ED9D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x0000025E6751DA80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000025E6746B920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000025E67391800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641949, "message": {"message_id": 1048, "from": {"id": 459471362, "is_bot": false, "first_name": "Di...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0000025E7F514A50>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x0000025E68E8F2D0>
                 │    │                │      └ <Update {"update_id": 56641949, "message": {"message_id": 1048, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                 │    │                └ <function Handler.notify at 0x0000025E690BDE40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x0000025E0B4EFA90>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0000025E7F514A50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x0000025E16A77350>}
                     │           │        └ (<Message {"message_id": 1048, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ...
                     │           └ <function check_task at 0x0000025E0B5714E0>
                     └ Handler.HandlerObj(handler=<function check_task at 0x0000025E0B5714E0>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 326, in check_task
    session_for_new_objects.commit()
    │                       └ <function Session.commit at 0x0000025E694A0E00>
    └ <sqlalchemy.orm.session.Session object at 0x0000025E16A773D0>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1905, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x0000025E69497F60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000025E1203F9D0>
  File "<string>", line 2, in commit
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000025E1203F9D0>
                └ <function SessionTransaction.commit at 0x0000025E69497D80>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1220, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x0000025E69497C40>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000025E1203F9D0>
  File "<string>", line 2, in _prepare_impl
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000025E1203F9D0>
                └ <function SessionTransaction._prepare_impl at 0x0000025E69497BA0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1195, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x0000025E694A3B00>
    │    └ <sqlalchemy.orm.session.Session object at 0x0000025E16A773D0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000025E1203F9D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4153, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x0000025E694A3CE0>
    └ <sqlalchemy.orm.session.Session object at 0x0000025E16A773D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4289, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000025E0F14B8C0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4250, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x0000025E694947C0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000025E0F141A10>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 467, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x0000025E0F141A10>
    │   └ <function SaveUpdateAll.execute at 0x0000025E69495300>
    └ SaveUpdateAll(Mapper[NotCheckedTask(not_checked_tasks)])
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 644, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x0000025E6941F4C0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\pe...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\pr...
    └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x0000025E69443560>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1040, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x0000025E6854D8A0>
             └ <sqlalchemy.engine.base.Connection object at 0x0000025E0B471AD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x0000025E0E0FB7D0>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000025E6854DBC0>
           └ <sqlalchemy.engine.base.Connection object at 0x0000025E0B471AD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000025E6854DDA0>
          └ <sqlalchemy.engine.base.Connection object at 0x0000025E0B471AD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1841, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000025E6854DE40>
           └ <sqlalchemy.engine.base.Connection object at 0x0000025E0B471AD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000025E6854E0C0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000025E0B471AD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UniqueViolation('duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDETAIL:  Key (receiver_id, task_num...
          │                    │              └ (<class 'psycopg2.errors.UniqueViolation'>, UniqueViolation('duplicate key value violates unique constraint "not_checked_task...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000025E68618CC0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000025E6A634410>
    └ <sqlalchemy.engine.base.Connection object at 0x0000025E0B471AD0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'admin_id': 459471362, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 1053}
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000025E1A0459A0; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (receiver_id, task_number)=(459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id)s, %(receiver_id)s, %(task_number)s, %(message_id)s)]
[parameters: {'admin_id': 459471362, 'receiver_id': 459471362, 'task_number': 1, 'message_id': 1053}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2023-06-23T23:04:48.277027+0300 ERROR Class 'builtins.NoneType' is not mapped
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3382, in delete
    state = attributes.instance_state(instance)
            │          │              └ None
            │          └ operator.attrgetter('_sa_instance_state')
            └ <module 'sqlalchemy.orm.attributes' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\att...

AttributeError: 'NoneType' object has no attribute '_sa_instance_state'


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 724, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x000001B0A77B8360>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001B086D5D990>
    │        └ <function start_polling at 0x000001B0853F9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x000001B0853FA700>
    └ <aiogram.utils.executor.Executor object at 0x000001B0A77B36D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x000001B08376DA80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001B0836A7920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001B0835D9800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56641994, "callback_query": {"id": "3453769093336260380", "from": {"id": 804143281, "is_bot": false, "...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001B086D5D990>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in process_update
    return await self.callback_query_handlers.notify(update.callback_query)
                 │    │                       │      │      └ <aiogram.types.fields.Field object at 0x000001B0850DB390>
                 │    │                       │      └ <Update {"update_id": 56641994, "callback_query": {"id": "3453769093336260380", "from": {"id": 804143281, "is_bot": false, "f...
                 │    │                       └ <function Handler.notify at 0x000001B085321E40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x000001B086A44FD0>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x000001B086D5D990>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'callback_data': {'@': 'Canc', 'receiver_id': '459471362', 'task_number': '1'}}
                     │           │        └ (<CallbackQuery {"id": "3453769093336260380", "from": {"id": 804143281, "is_bot": false, "first_name": "Наталья", "language_c...
                     │           └ <function drop_state at 0x000001B0A77AFA60>
                     └ Handler.HandlerObj(handler=<function drop_state at 0x000001B0A77AFA60>, spec=FullArgSpec(args=['callback_query', 'callback_da...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 613, in drop_state
    await delete_state_from_db(callback_query.from_user.id)
          │                    │              └ <aiogram.types.fields.Field object at 0x000001B084FF2490>
          │                    └ <CallbackQuery {"id": "3453769093336260380", "from": {"id": 804143281, "is_bot": false, "first_name": "Наталья", "language_co...
          └ <function delete_state_from_db at 0x000001B0A779F560>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 70, in delete_state_from_db
    session.delete(existing_state)
    │       │      └ None
    │       └ <function Session.delete at 0x000001B0866B7100>
    └ <sqlalchemy.orm.session.Session object at 0x000001B0A537ECD0>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3384, in delete
    raise exc.UnmappedInstanceError(instance) from err
          │   │                     └ None
          │   └ <class 'sqlalchemy.orm.exc.UnmappedInstanceError'>
          └ <module 'sqlalchemy.orm.exc' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\exc.py'>

sqlalchemy.orm.exc.UnmappedInstanceError: Class 'builtins.NoneType' is not mapped
2023-06-23T23:06:38.521111+0300 ERROR (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (admin_id, receiver_id, task_number)=(804143281, 459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id__0)s, %(receiver_id__0)s, %(task_number__0)s, %(message_id__0)s), (%(admin_id__1)s, %(receiver_id__1)s, %(task_number__1)s, %(message_id__1)s)]
[parameters: {'message_id__0': 1191, 'receiver_id__0': 459471362, 'admin_id__0': 804143281, 'task_number__0': 1, 'message_id__1': 1194, 'receiver_id__1': 459471362, 'admin_id__1': 459471362, 'task_number__1': 1}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2108, in _exec_insertmany_context
    dialect.do_execute(
    │       └ <function DefaultDialect.do_execute at 0x00000229F463CCC0>
    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000229F665CC50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'message_id__0': 1191, 'receiver_id__0': 459471362, 'admin_id__0': 804143281, 'task_number__0': 1, 'message_id__1': 1194, 'r...
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id__0)s, %(receiver_id__0)s, ...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002299A39A960; closed: -1>

psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (admin_id, receiver_id, task_number)=(804143281, 459471362, 1) already exists.



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 724, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x0000022997648360>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>
    │        └ <function start_polling at 0x00000229F51D9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000229F51DA700>
    └ <aiogram.utils.executor.Executor object at 0x0000022997643290>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x00000229F354DA80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000229F3487920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000229F33B9800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56642000, "message": {"message_id": 1189, "from": {"id": 459471362, "is_bot": false, "first_name": "Di...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 256, in process_update
    return await self.message_handlers.notify(update.message)
                 │    │                │      │      └ <aiogram.types.fields.Field object at 0x00000229F4EBB150>
                 │    │                │      └ <Update {"update_id": 56642000, "message": {"message_id": 1189, "from": {"id": 459471362, "is_bot": false, "first_name": "Dim...
                 │    │                └ <function Handler.notify at 0x00000229F5101E40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x00000229F682B510>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'state': <aiogram.dispatcher.storage.FSMContext object at 0x0000022997B02190>}
                     │           │        └ (<Message {"message_id": 1189, "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_name": "ᴵᵀ ᵖʳᵒᵈ...
                     │           └ <function check_task at 0x000002299763DB20>
                     └ Handler.HandlerObj(handler=<function check_task at 0x000002299763DB20>, spec=FullArgSpec(args=['message', 'state'], varargs=N...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 326, in check_task
    session.commit()
    │       └ <function Session.commit at 0x00000229F54C4E00>
    └ <sqlalchemy.orm.session.Session object at 0x0000022997E03090>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1905, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x00000229F54BBF60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000022997BCD630>
  File "<string>", line 2, in commit
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000022997BCD630>
                └ <function SessionTransaction.commit at 0x00000229F54BBD80>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1220, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x00000229F54BBC40>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000022997BCD630>
  File "<string>", line 2, in _prepare_impl
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000022997BCD630>
                └ <function SessionTransaction._prepare_impl at 0x00000229F54BBBA0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1195, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x00000229F54C7B00>
    │    └ <sqlalchemy.orm.session.Session object at 0x0000022997E03090>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000022997BCD630>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4153, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x00000229F54C7CE0>
    └ <sqlalchemy.orm.session.Session object at 0x0000022997E03090>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4289, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x00000229A78EEE80>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4250, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x00000229F54B87C0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x00000229A77095D0>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 467, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x00000229A77095D0>
    │   └ <function SaveUpdateAll.execute at 0x00000229F54B9300>
    └ SaveUpdateAll(Mapper[NotCheckedTask(not_checked_tasks)])
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 644, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x00000229F54474C0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\pe...
    │    └ <module 'sqlalchemy.util.preloaded' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\pr...
    └ <module 'sqlalchemy.util' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x00000229F5463560>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1040, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x00000229F45718A0>
             └ <sqlalchemy.engine.base.Connection object at 0x000002299FE91150>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x00000229A7880A90>>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x00000229F4571BC0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002299FE91150>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x00000229F4571DA0>
          └ <sqlalchemy.engine.base.Connection object at 0x000002299FE91150>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1836, in _execute_context
    return self._exec_insertmany_context(
           │    └ <function Connection._exec_insertmany_context at 0x00000229F4571EE0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002299FE91150>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2116, in _exec_insertmany_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x00000229F45720C0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002299FE91150>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UniqueViolation('duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDETAIL:  Key (admin_id, receiver_id...
          │                    │              └ (<class 'psycopg2.errors.UniqueViolation'>, UniqueViolation('duplicate key value violates unique constraint "not_checked_task...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"\nDE...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2108, in _exec_insertmany_context
    dialect.do_execute(
    │       └ <function DefaultDialect.do_execute at 0x00000229F463CCC0>
    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000229F665CC50>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'message_id__0': 1191, 'receiver_id__0': 459471362, 'admin_id__0': 804143281, 'task_number__0': 1, 'message_id__1': 1194, 'r...
    │      │       └ 'INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id__0)s, %(receiver_id__0)s, ...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002299A39A960; closed: -1>

sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "not_checked_tasks_pkey"
DETAIL:  Key (admin_id, receiver_id, task_number)=(804143281, 459471362, 1) already exists.

[SQL: INSERT INTO not_checked_tasks (admin_id, receiver_id, task_number, message_id) VALUES (%(admin_id__0)s, %(receiver_id__0)s, %(task_number__0)s, %(message_id__0)s), (%(admin_id__1)s, %(receiver_id__1)s, %(task_number__1)s, %(message_id__1)s)]
[parameters: {'message_id__0': 1191, 'receiver_id__0': 459471362, 'admin_id__0': 804143281, 'task_number__0': 1, 'message_id__1': 1194, 'receiver_id__1': 459471362, 'admin_id__1': 459471362, 'task_number__1': 1}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2023-06-23T23:06:55.063815+0300 ERROR An error has been caught in function 'decline_task_with_comment', process 'MainProcess' (12532), thread 'MainThread' (10700):
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 724, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x0000022997648360>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>
    │        └ <function start_polling at 0x00000229F51D9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000229F51DA700>
    └ <aiogram.utils.executor.Executor object at 0x0000022997643290>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x00000229F354DA80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000229F3487920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000229F33B9800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56642001, "callback_query": {"id": "3453769095067672709", "from": {"id": 804143281, "is_bot": false, "...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in process_update
    return await self.callback_query_handlers.notify(update.callback_query)
                 │    │                       │      │      └ <aiogram.types.fields.Field object at 0x00000229F4EBB2D0>
                 │    │                       │      └ <Update {"update_id": 56642001, "callback_query": {"id": "3453769095067672709", "from": {"id": 804143281, "is_bot": false, "f...
                 │    │                       └ <function Handler.notify at 0x00000229F5101E40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x00000229F6828A90>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'callback_data': {'@': 'Dec+comm', 'receiver_id': '459471362'}}
                     │           │        └ (<CallbackQuery {"id": "3453769095067672709", "from": {"id": 804143281, "is_bot": false, "first_name": "Наталья", "language_c...
                     │           └ <function decline_task_with_comment at 0x000002299763EA20>
                     └ Handler.HandlerObj(handler=<function decline_task_with_comment at 0x000002299763EA20>, spec=FullArgSpec(args=['callback_query...

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 494, in decline_task_with_comment
    reply_markup=get_ikb_to_cancel_state())
                 └ <function get_ikb_to_cancel_state at 0x00000229F681BD80>

TypeError: get_ikb_to_cancel_state() missing 2 required positional arguments: 'receiver_id' and 'task_number'
2023-06-23T23:08:02.955959+0300 ERROR Class 'builtins.NoneType' is not mapped
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3382, in delete
    state = attributes.instance_state(instance)
            │          │              └ None
            │          └ operator.attrgetter('_sa_instance_state')
            └ <module 'sqlalchemy.orm.attributes' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\att...

AttributeError: 'NoneType' object has no attribute '_sa_instance_state'


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 724, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x0000022997648360>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>
    │        └ <function start_polling at 0x00000229F51D9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000229F51DA700>
    └ <aiogram.utils.executor.Executor object at 0x0000022997643290>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x00000229F354DA80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000229F3487920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000229F33B9800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56642007, "callback_query": {"id": "3453769094435237425", "from": {"id": 804143281, "is_bot": false, "...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in process_update
    return await self.callback_query_handlers.notify(update.callback_query)
                 │    │                       │      │      └ <aiogram.types.fields.Field object at 0x00000229F4EBB2D0>
                 │    │                       │      └ <Update {"update_id": 56642007, "callback_query": {"id": "3453769094435237425", "from": {"id": 804143281, "is_bot": false, "f...
                 │    │                       └ <function Handler.notify at 0x00000229F5101E40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x00000229F6828A90>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'callback_data': {'@': 'Canc', 'receiver_id': '459471362', 'task_number': '1'}}
                     │           │        └ (<CallbackQuery {"id": "3453769094435237425", "from": {"id": 804143281, "is_bot": false, "first_name": "Наталья", "language_c...
                     │           └ <function drop_state at 0x000002299763FA60>
                     └ Handler.HandlerObj(handler=<function drop_state at 0x000002299763FA60>, spec=FullArgSpec(args=['callback_query', 'callback_da...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 613, in drop_state
    await delete_state_from_db(callback_query.from_user.id)
          │                    │              └ <aiogram.types.fields.Field object at 0x00000229F4DD2350>
          │                    └ <CallbackQuery {"id": "3453769094435237425", "from": {"id": 804143281, "is_bot": false, "first_name": "Наталья", "language_co...
          └ <function delete_state_from_db at 0x000002299762F560>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 70, in delete_state_from_db
    session.delete(existing_state)
    │       │      └ None
    │       └ <function Session.delete at 0x00000229F54C7100>
    └ <sqlalchemy.orm.session.Session object at 0x0000022997CE0450>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3384, in delete
    raise exc.UnmappedInstanceError(instance) from err
          │   │                     └ None
          │   └ <class 'sqlalchemy.orm.exc.UnmappedInstanceError'>
          └ <module 'sqlalchemy.orm.exc' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\exc.py'>

sqlalchemy.orm.exc.UnmappedInstanceError: Class 'builtins.NoneType' is not mapped
2023-06-23T23:09:11.634654+0300 ERROR Class 'builtins.NoneType' is not mapped
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3382, in delete
    state = attributes.instance_state(instance)
            │          │              └ None
            │          └ operator.attrgetter('_sa_instance_state')
            └ <module 'sqlalchemy.orm.attributes' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\att...

AttributeError: 'NoneType' object has no attribute '_sa_instance_state'


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 724, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x0000022997648360>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>
    │        └ <function start_polling at 0x00000229F51D9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000229F51DA700>
    └ <aiogram.utils.executor.Executor object at 0x0000022997643290>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x00000229F354DA80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000229F3487920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000229F33B9800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56642009, "callback_query": {"id": "1973414474275265189", "from": {"id": 459471362, "is_bot": false, "...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in process_update
    return await self.callback_query_handlers.notify(update.callback_query)
                 │    │                       │      │      └ <aiogram.types.fields.Field object at 0x00000229F4EBB2D0>
                 │    │                       │      └ <Update {"update_id": 56642009, "callback_query": {"id": "1973414474275265189", "from": {"id": 459471362, "is_bot": false, "f...
                 │    │                       └ <function Handler.notify at 0x00000229F5101E40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x00000229F6828A90>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'callback_data': {'@': 'Canc', 'receiver_id': '459471362', 'task_number': '1'}}
                     │           │        └ (<CallbackQuery {"id": "1973414474275265189", "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_...
                     │           └ <function drop_state at 0x000002299763FA60>
                     └ Handler.HandlerObj(handler=<function drop_state at 0x000002299763FA60>, spec=FullArgSpec(args=['callback_query', 'callback_da...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 613, in drop_state
    await delete_state_from_db(callback_query.from_user.id)
          │                    │              └ <aiogram.types.fields.Field object at 0x00000229F4DD2350>
          │                    └ <CallbackQuery {"id": "1973414474275265189", "from": {"id": 459471362, "is_bot": false, "first_name": "Dima Tatarin", "last_n...
          └ <function delete_state_from_db at 0x000002299762F560>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 70, in delete_state_from_db
    session.delete(existing_state)
    │       │      └ None
    │       └ <function Session.delete at 0x00000229F54C7100>
    └ <sqlalchemy.orm.session.Session object at 0x0000022997CE0610>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3384, in delete
    raise exc.UnmappedInstanceError(instance) from err
          │   │                     └ None
          │   └ <class 'sqlalchemy.orm.exc.UnmappedInstanceError'>
          └ <module 'sqlalchemy.orm.exc' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\exc.py'>

sqlalchemy.orm.exc.UnmappedInstanceError: Class 'builtins.NoneType' is not mapped
2023-06-23T23:09:30.567397+0300 ERROR Class 'builtins.NoneType' is not mapped
Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3382, in delete
    state = attributes.instance_state(instance)
            │          │              └ None
            │          └ operator.attrgetter('_sa_instance_state')
            └ <module 'sqlalchemy.orm.attributes' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\att...

AttributeError: 'NoneType' object has no attribute '_sa_instance_state'


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 724, in <module>
    executor.start_polling(dispatcher=dp, skip_updates=True, on_startup=on_startup)
    │        │                        │                                 └ <function on_startup at 0x0000022997648360>
    │        │                        └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>
    │        └ <function start_polling at 0x00000229F51D9BC0>
    └ <module 'aiogram.utils.executor' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\aiogram\\utils\\executo...

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 45, in start_polling
    executor.start_polling(
    │        └ <function Executor.start_polling at 0x00000229F51DA700>
    └ <aiogram.utils.executor.Executor object at 0x0000022997643290>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\utils\executor.py", line 323, in start_polling
    loop.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x00000229F354DA80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000229F3487920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000229F33B9800>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\Dima Tatarin\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {}
                     │           │        └ (<Update {"update_id": 56642011, "callback_query": {"id": "3453769096339762290", "from": {"id": 804143281, "is_bot": false, "...
                     │           └ <bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>>
                     └ Handler.HandlerObj(handler=<bound method Dispatcher.process_update of <aiogram.dispatcher.dispatcher.Dispatcher object at 0x0...
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in process_update
    return await self.callback_query_handlers.notify(update.callback_query)
                 │    │                       │      │      └ <aiogram.types.fields.Field object at 0x00000229F4EBB2D0>
                 │    │                       │      └ <Update {"update_id": 56642011, "callback_query": {"id": "3453769096339762290", "from": {"id": 804143281, "is_bot": false, "f...
                 │    │                       └ <function Handler.notify at 0x00000229F5101E40>
                 │    └ <aiogram.dispatcher.handler.Handler object at 0x00000229F6828A90>
                 └ <aiogram.dispatcher.dispatcher.Dispatcher object at 0x00000229975C0050>
  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\aiogram\dispatcher\handler.py", line 117, in notify
    response = await handler_obj.handler(*args, **partial_data)
                     │           │        │       └ {'callback_data': {'@': 'Canc', 'receiver_id': '459471362', 'task_number': '1'}}
                     │           │        └ (<CallbackQuery {"id": "3453769096339762290", "from": {"id": 804143281, "is_bot": false, "first_name": "Наталья", "language_c...
                     │           └ <function drop_state at 0x000002299763FA60>
                     └ Handler.HandlerObj(handler=<function drop_state at 0x000002299763FA60>, spec=FullArgSpec(args=['callback_query', 'callback_da...

  File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 613, in drop_state
    await delete_state_from_db(callback_query.from_user.id)
          │                    │              └ <aiogram.types.fields.Field object at 0x00000229F4DD2350>
          │                    └ <CallbackQuery {"id": "3453769096339762290", "from": {"id": 804143281, "is_bot": false, "first_name": "Наталья", "language_co...
          └ <function delete_state_from_db at 0x000002299762F560>

> File "C:\xStorage\Projects\PrometeyBot\root\tg\main.py", line 70, in delete_state_from_db
    session.delete(existing_state)
    │       │      └ None
    │       └ <function Session.delete at 0x00000229F54C7100>
    └ <sqlalchemy.orm.session.Session object at 0x00000229A8B0A550>

  File "C:\xStorage\Projects\PrometeyBot\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3384, in delete
    raise exc.UnmappedInstanceError(instance) from err
          │   │                     └ None
          │   └ <class 'sqlalchemy.orm.exc.UnmappedInstanceError'>
          └ <module 'sqlalchemy.orm.exc' from 'C:\\xStorage\\Projects\\PrometeyBot\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\exc.py'>

sqlalchemy.orm.exc.UnmappedInstanceError: Class 'builtins.NoneType' is not mapped
